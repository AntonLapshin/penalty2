define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("social/social",[],function(){var e;return{init:function(t){return e=t,e.init()},invite:function(){e.invite()},showOrderBox:function(){return e.showOrderBox()},getUserUrl:function(t){return e.getUserUrl(t)},getUnknowImg:function(){return e.getUnknowImg()},wallPost:function(t){return e.wallPost(t)},getMe:function(){return e.getMe()},getUsers:function(t){return e.getUsers(t)},getFriendsUsers:function(){return e.getFriendsUsers()},isUserInGroup:function(t){return e.isUserInGroup(t)},getCommunityHref:function(){return e.getCommunityHref()}}}),define("plugins/format",[],function(){return function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,n){return typeof t[n]!="undefined"?t[n]:e})}}),define("social/vk",["jquery","vk","plugins/format"],function(e,t,n){function u(e){return e.indexOf("http://cs")===-1?e.replace("http://","https://"):"https://pp.vk.me/c"+e.replace("http://cs","").replace(".vk.me","")}function a(e){return{id:e.uid||e.id,img:u(e.photo_50),name:e.first_name+" "+e.last_name}}var r="71627954",i="photo-71627954_332801553",s="https://vk.com/app4446829",o="Занятое место на чемпионате мира: {0}. Попробуй свои силы в послематчевых пенальти на чемпионате мира 2014 {1}";return{init:function(){return e.Deferred(function(e){VK.init(function(){e.resolve()},function(){},"5.21")})},getUserUrl:function(e){return"https://vk.com/id"+e},getUnknowImg:function(){return"//vk.com/images/deactivated_50.gif"},invite:function(){VK.callMethod("showInviteBox")},showOrderBox:function(){return e.Deferred(function(e){VK.addCallback("onOrderSuccess",function(t){e.resolve()}),VK.addCallback("onOrderFail",function(){e.reject("fail")}),VK.addCallback("onOrderCancel",function(){e.reject("cancel")}),VK.callMethod("showOrderBox",{type:"votes",votes:1})})},wallPost:function(t){return e.Deferred(function(e){VK.api("wall.post",{attachments:i,message:n(o,t,s)},function(t){e.resolve(t)})})},getMe:function(){var t=this;return e.Deferred(function(e){VK.api("users.get",{user_ids:undefined,fields:"photo_50",name_case:"Nom"},function(t){(!t||t.error)&&e.resolve();var n=[];if(!t.response){e.resolve();return}t.response.forEach(function(e){n.push(a(e))}),e.resolve(n[0])})})},getUsers:function(t){return e.Deferred(function(e){function n(t){if(!t||t.error||!t.response){e.resolve([]);return}var n=[];t.response.forEach(function(e){n.push(a(e))}),e.resolve(n)}t&&t.length===1&&(t=t[0]),VK.api("users.get",{user_ids:t,fields:"photo_50",name_case:"Nom"},n)})},getFriendsUsers:function(){var t=this;return e.Deferred(function(e){VK.api("friends.getAppUsers",function(n){if(!n||!n.response||!n.response.length||n.response.length===0){e.resolve([]);return}var r=n.response;t.getUsers(r).then(function(t){e.resolve(t)})})})},isUserInGroup:function(t){return e.Deferred(function(e){VK.api("groups.isMember",{user_id:t,group_id:r},function(t){e.resolve(t.response.member===1)})})},getCommunityHref:function(){return"//vk.com/club71627954"}}}),define("server/server",["jquery"],function(e){var t,n={loadTopUsers:{lastDateTime:0,data:null,timeout:3e5}};return{init:function(e){return t=e,e.init()},loadUsers:function(e){return t.loadUsers(e)},loadTopUsers:function(){return Date.now()-n.loadTopUsers.lastDateTime>n.loadTopUsers.timeout?e.Deferred(function(e){t.loadTopUsers().then(function(t){n.loadTopUsers.lastDateTime=Date.now(),n.loadTopUsers.data=t,e.resolve(t)})}):e.Deferred(function(e){e.resolve(n.loadTopUsers.data)})},saveUser:function(e){return t.saveUser(e)}}}),define("plugins/ajax",["jquery"],function(e){function i(e,r){var i=t+e+"?";if(r!=null)for(var s in r)i=i+s+"="+r[s]+"&";return i+=n,i}var t=window.cfg.server,n="callback=?",r=5e4;return{callAjax:function(t,n){return e.ajax({url:i(t,n),type:"GET",dataType:"json",timeout:r})}}}),define("server/heroku",["jquery","plugins/ajax"],function(e,t){return{init:function(){return e.Deferred(function(e){e.resolve()})},loadUsers:function(e){return t.callAjax("scores",{ids:e})},loadTopUsers:function(){return t.callAjax("top",null)},saveUser:function(e){return t.callAjax("upsert",e)}}}),define("model/resources",[],function(){return{GAME:[{src:"//pp.vk.me/c619417/v619417333/d5ef/qxUrsjhRcz4.jpg",name:"background",target:[".intro",".match",".result",".choice",".tournament"],required:!0},{src:"//pp.vk.me/c619417/v619417333/d5f7/QOj4EmWNDRY.jpg",name:"background-top",target:[".top"],required:!0},{src:"//pp.vk.me/c619417/v619417333/d606/CsI5pMosgKA.jpg",name:"instruction",target:[".instruction img"]}],ENGINE:[{name:"field",src:"//pp.vk.me/c619417/v619417333/d5ff/yjrJzLFLkVw.jpg",required:!0},{name:"gate",src:"engine/img/gate.png",required:!0},{name:"ball",src:"engine/img/ball_brazil.png",required:!0},{name:"head",src:"engine/img/head.png",required:!0},{name:"leftHand",src:"engine/img/leftHand.png",required:!0},{name:"rightHand",src:"engine/img/rightHand.png",required:!0},{name:"stadium",src:"engine/mp3/stadium.mp3",loop:!0,duration:7},{name:"strike",src:"engine/mp3/strike.mp3"},{name:"goal",src:"engine/mp3/goal.mp3"},{name:"miss",src:"engine/mp3/miss.mp3"}]}}),define("plugins/loader",["model/resources","lodash","howler"],function(e){function n(e){return $.Deferred(function(n){e.image$=$("<img />").on("load",function(){n.resolve();if(!e.target)return;e.target.forEach(function(t){function n(){var r=$(t);if(r.length===0){setTimeout(n,20);return}e.name.indexOf("background")!==-1?r.css("background-image","url("+e.src+")"):r.attr("src",e.src)}n()})}).attr("src",require.toUrl(e.src)),e.required||setTimeout(n.resolve,t)})}function r(e){return $.Deferred(function(n){e.audio=new Howl({urls:[require.toUrl(e.src)],loop:e.loop,onload:function(){n.resolve()}}),e.required||setTimeout(n.resolve,t)})}function i(e){var t=e.split("."),i=t[t.length-1];return i==="mp3"?r:n}var t=2e3;return{resources:e,getFile:function(t){for(var n in e){if(!e.hasOwnProperty(n))continue;var r=_.where(e[n],{name:t})[0];if(r&&r.loaded)return r}throw"Resource is not found: "+t},getAllFiles:function(){var t=[];for(var n in e){if(!e.hasOwnProperty(n))continue;t=t.concat(e[n])}return t},load:function(e,t){var n=e.length,r=[],s=0;return e.forEach(function(e){var o=i(e.src)(e);r.push(o),o.then(function(){e.loaded=!0,t&&t(Math.floor(++s/n*100))})}),$.when.apply($,r)}}}),define("plugins/localization",["ko"],function(e){var t,n={ru:0,en:1},r={choiceTitle:["Выбор команды","Choose the team"],turnPlayer:["Удар вашей команды","Your team beats"],turnComputer:["Удар соперника","Computer team beats"],goal:["Го-о-о-ол!","Gooooal!"],miss:["Промах!","Miss!"],crossbar:["Штанга!","Crossbar!"],scores:["Очки","Scores"],goals:["Забитые голы","Goals"],exp:["Мастерство","Experience"],instructionTitle:["Инструкция","Instruction"],rules1:["1. Для удара по мячу необходимо зажать левую кнопку мыши на мяче и потянуть в направлении удара, а затем отпустить.","1. Start attack by pulling forward the arrow with your finger or mouse pressing on the ball."],rules2:["2. Для выбора направления прыжка вратаря необходимо зажать левую кнопку мыши на голове вратаря и потянуть в направлении прыжка, а затем отпустить.","2. Start defend by pulling forward the arrow with your finger or mouse pressing on the goalkeeper."],rulesPenalty:["Правила пенальти","Penalty rules on wiki"],prev:["Назад","Return"],header1:["Пенальти.","Penalty."],header2:["Чемпионат мира по футболу 2014.","Football Championship 2014."],introDesc:["Сыграй за одну из любимых команд на чемпионате мира по футболу 2014 в Бразилии. Игра начнется со стадии плей-офф между вышедшими из группового этапа командами.","Play for your favourite team on football championship 2014 in Brazil."],btnStart:["Начать игру","Start game"],btnInstruction:["Инструкция","Instruction"],firstTurn:["Право первого удара: ","Who turns the first? "],drawLot:["Кинуть жребий","Draw a lot"],titleResults:["Результаты чемпионата","Championship Results"],txtPlace:["Занятое место","Your place"],linkGroup:["Перейти в группу","Go to community"],linkInvite:["Пригласить друзей","Invite friends"],txtWin:["Победа!","Win!"],txtDefeat:["Поражение","Defeat"],linkTopFriends:["Топ друзей","Friends Top"],linkTopAll:["Общий топ","All Top"],txtGoRound:["Сыграть тур","Play Round"],txtTwistBall:["Закрутка мяча","Twist the ball"],teamBrazil:["Бразилия","Brazil"],teamMexico:["Мексика","Mexico"],teamNetherlands:["Нидерланды","Netherlands"],teamChily:["Чили","Chily"],teamRussia:["Россия","Russia"],teamGreace:["Греция","Greace"],teamCostaRica:["Коста-Рика","Costa-Rica"],teamUruguai:["Уругвай","Uruguai"],teamFrance:["Франция","France"],teamEkvador:["Эквадор","Ekvador"],teamArgentina:["Аргентина","Argentina"],teamNigeria:["Нигерия","Nigeria"],teamGermany:["Германия","Germany"],teamUSA:["США","USA"],teamBelgium:["Бельгия","Belgium"],teamAlgzir:["Алжир","Algzir"],txtInvite:["Пригласить друга","Invite"],psychicText:["Помощь экстрасенса. Всего за 1 голос экстрасенс поможет угадать направление удара и прыжка противника в этой серии пенальти.","Psychic help. Only for one vote Psychic can help you to guess direction of attack and goalkeeper throw in that match."],psychicTextEnabled:["В этом матче Вам помогает экстрасенс","In that match the Psychic helps you"],txtTimer:["До начала турнира","Time left"],txtTimerVote:["За 1 голос ты можешь начать новый турнир прямо сейчас","For 1 vote you can continue game right now"]},i={getLanguage:function(){return t},setLanguage:function(i){t=i;for(var s in r){if(!r.hasOwnProperty(s))continue;this[s]?this[s](r[s][n[t]]):this[s]=e.observable(r[s][n[t]])}}};return i.setLanguage(window.cfg.language),i}),define("model/teams",["plugins/localization"],function(e){return[{power:9,player:!1,name:e.teamBrazil,className:"team-brazil"},{power:7,player:!1,name:e.teamMexico,className:"team-mexico"},{power:8,player:!1,name:e.teamNetherlands,className:"team-netherlands"},{power:6,player:!1,name:e.teamChily,className:"team-chily"},{power:7,player:!1,name:e.teamRussia,className:"team-rus"},{power:4,player:!1,name:e.teamGreace,className:"team-greace"},{power:6,player:!1,name:e.teamCostaRica,className:"team-costa-rica"},{power:7,player:!1,name:e.teamUruguai,className:"team-uruguai"},{power:8,player:!1,name:e.teamFrance,className:"team-france"},{power:5,player:!1,name:e.teamEkvador,className:"team-ekvador"},{power:9,player:!1,name:e.teamArgentina,className:"team-argentina"},{power:7,player:!1,name:e.teamNigeria,className:"team-nigeria"},{power:9,player:!1,name:e.teamGermany,className:"team-germany"},{power:4,player:!1,name:e.teamUSA,className:"team-usa"},{power:5,player:!1,name:e.teamBelgium,className:"team-belgium"},{power:6,player:!1,name:e.teamAlgzir,className:"team-alzgir"}]}),define("controllers/users",["server/server","social/social","plugins/localization"],function(e,t,n){function r(e,n){var r=[];return t.getUsers(e).then(function(e){var t=[];for(var r=0;r<e.length;r++)t.push(a(e[r],n[e[r].id]));return t})}function i(e,t){return e.forEach(function(e){t.forEach(function(t){if(t.id==e._id){t.isMerged=!0;for(var n in t)e[n]=t[n]}})}),t.forEach(function(t){if(t.isMerged)return;e.push(a(t))}),e}function s(e){var t=[];return e.forEach(function(e){t.push(e.id||e._id)}),t}function o(e,t){var n={};for(var r=0;r<e.length;r++)n[e[r]]=t[e[r]]||0;return n}function u(e){var t={};for(var n=0;n<e.length;n++)t[e[n]._id]=e[n];return t}function a(e,r){return e=e||{id:"0",img:t.getUnknowImg(),name:n.txtInvite},r=r||{score:0,goals:0,miss:0,exp:0,last:0},{id:e.id,img:e.img,name:e.name,score:r.score,goals:r.goals,miss:r.miss,exp:r.exp,last:r.last}}return{newPlayer:a,getMe:function(){return t.getMe().then(function(t){return $.Deferred(function(n){e.loadUsers([t.id]).then(function(e){n.resolve(i(e,[t])[0])})})})},getTopUsers:function(){return e.loadTopUsers().then(function(e){return e.length==0?[]:$.Deferred(function(n){t.getUsers(s(e)).then(function(t){e=i(e,t),n.resolve(e)})})})},getFriendsUsers:function(){return t.getFriendsUsers().then(function(t){return t.length===0?[]:$.Deferred(function(n){e.loadUsers(s(t)).then(function(e){e=i(e,t),n.resolve(e)})})})}}}),define("plugins/options",["model/teams","server/server","controllers/users"],function(e,t,n){return{teams:e,goals:-1,miss:-1,place:-1,init:function(e){this.teams[e].isPlayer=!0,this.goals=0,this.miss=0},save:function(){return t.saveUser({id:this.player.id,score:this.player.score,goals:this.player.goals,miss:this.player.miss,exp:this.player.exp})},load:function(){var e=this;return n.getMe().then(function(t){e.player=t})},upgrade:function(){this.player.goals+=this.goals,this.player.miss+=this.miss,this.player.exp+=1,this.exp+=1}}}),define("text!c/lang/view.html",[],function(){return'<div class="lang" data-bind="visible: isVisible">\r\n    <div class="container">\r\n        <div class="switch">\r\n            <input type="radio" class="switch-input" name="lang" value="en" id="en" data-bind="attr: { checked: lang() == \'en\' }">\r\n            <label for="en" class="switch-label" data-bind="event: { mouseup: en }">EN</label>\r\n            <input type="radio" class="switch-input" name="lang" value="ru" id="ru" data-bind="attr: { checked: lang() == \'ru\' }">\r\n            <label for="ru" class="switch-label ru" data-bind="event: { mouseup: ru }">RU</label>\r\n            <span class="switch-selection"></span>\r\n        </div>\r\n    </div>\r\n</div>'}),define("plugins/component",["ko"],function(e){function n(n,r,i){return typeof r=="function"?(this.name=n,this.isVisible=e.observable(!1),r.call(this),t[n]=this,i&&this.show(i),this):(r.name=n,r.isVisible=e.observable(!1),t[n]=r,r)}function r(e,r,i){var s=r+"+"+(e?(typeof e.name=="function"?e.name():e.name)||"default":"default");return t[s]?(e&&typeof i=="function"&&t[s].set(e),t[s]):new n(s,i,e)}var t={};return{add:function(t,n,i){var s={viewModel:function(e){return r(e,i,t)},template:n};return e.components.isRegistered(i)||e.components.register(i,s),s.viewModel()}}}),define("c/lang/vm",["ko","text!./view.html","plugins/component","plugins/localization"],function(e,t,n,r){var i={lang:e.observable(window.cfg.language),show:function(){this.isVisible(!0)},en:function(){this.lang("en"),r.setLanguage("en")},ru:function(){this.lang("ru"),r.setLanguage("ru")},test:function(){this.show()}};return n.add(i,t,"lang")}),define("text!c/info/view.html",[],function(){return'<div class="info" data-bind="visible: isVisible">\r\n    <div class="back"></div>\r\n    <div>\r\n        <!-- ko if: user -->\r\n        <img alt="" src="" data-bind="attr: { src: user().img }">\r\n        <p class="name" data-bind="text: user().name"></p>\r\n        <p><span data-bind="text: scores"></span> : <span data-bind="text: user().score"></span></p>\r\n        <p><span data-bind="text: goals"></span> : <span data-bind="text: user().goals"></span></p>\r\n        <p><span data-bind="text: exp"></span> : <span data-bind="text: user().exp"></span></p>\r\n        <!-- /ko -->\r\n    </div>\r\n</div>'}),define("c/info/vm",["ko","text!./view.html","plugins/component","plugins/localization"],function(e,t,n,r){var i={user:e.observable(null),scores:r.scores,goals:r.goals,exp:r.exp,show:function(e){if(e.id==0)return;this.user(e),this.isVisible(!0)},hide:function(){this.user(this.defaultUser)},init:function(e){this.defaultUser=e,this.hide()},test:function(){var e=this;require(["controllers/users"],function(t){t.getMe().then(function(t){e.show(t)})})}};return n.add(i,t,"info")}),define("text!c/timer/view.html",[],function(){return'<div class="timer" data-bind="visible: isVisible, click: click">\r\n    <p class="desc" data-bind="text: txtTimer"></p>\r\n    <p class="time" data-bind="text: value"></p>\r\n    <div class="popup" data-bind="visible: isPaymentEnabled, text: txtTimerVote">\r\n    </div>\r\n</div>'}),define("c/timer/vm",["ko","text!./view.html","plugins/component","jquery","plugins/localization","social/social"],function(e,t,n,r,i,s){var o,u,a=!1,f={isPaymentEnabled:window.cfg.payments,value:e.observable(""),txtTimer:i.txtTimer,txtTimerVote:i.txtTimerVote,setValue:function(){var e=Math.floor(u/60),t=Math.floor(u%60);t<10&&(t="0"+t),this.value(e+":"+t)},test:function(){this.show(Date.now())},click:function(){var e=this;if(!this.isPaymentEnabled)return;s.showOrderBox().then(function(){e.isVisible(!1),a=!0})},show:function(e){a=!1;if(o)return;var t=(Date.now()-e)/1e3,n=t/60;if(n>=10)return;var r=6e5-(Date.now()-e);u=Math.floor(r/1e3),this.setValue();var i=this;o=setInterval(function(){u--,i.setValue(),u===0&&(i.isVisible(!1),clearInterval(o))},1e3),this.isVisible(!0)},highlight:function(){return a?!1:u?(r(".timer").animate({opacity:1},200).animate({color:"red"},100).animate({opacity:.3},500),!0):!1}};return n.add(f,t,"timer")}),define("text!c/sound/view.html",[],function(){return'<div class="sound" data-bind="visible: isVisible, click: press" title="Звук">\r\n    <img class="on" src="components/sound/mute.png" alt="" data-bind="visible: isMuted" />\r\n    <img class="off" src="components/sound/unmute.png" alt="" data-bind="visible: isMuted() === false" />\r\n</div>'}),define("plugins/audio",["jquery","plugins/loader","howler"],function(e,t){var n=.5;return{play:function(e){var r=t.getFile(e);if(!r||!r.audio)return;r.audio.volume=n,r.audio.play()},isMuted:function(){return Howler._muted},stop:function(){var e=t.getAllFiles();e.forEach(function(e){e.audio&&e.audio.stop()})},mute:function(){Howler.mute()},unmute:function(){Howler.unmute()}}}),define("c/sound/vm",["ko","text!./view.html","plugins/component","plugins/audio"],function(e,t,n,r){var i={isMuted:e.observable(!1),show:function(){this.isVisible(!0)},unmute:function(){r.unmute(),this.isMuted(!1)},mute:function(){r.mute(),this.isMuted(!0)},press:function(){r.isMuted()?this.unmute():this.mute()},test:function(){var e=this;require(["plugins/loader"],function(t){t.load(t.resources.ENGINE).then(function(){e.show(),r.play("stadium")})})}};return n.add(i,t,"sound")}),define("text!c/top/view.html",[],function(){return'<div class="top" data-bind="visible: isVisible()">\r\n    <ul data-bind="foreach: visibleUsers">\r\n        <member params="name: \'top\' + $index(), user: $data"></member>\r\n    </ul>\r\n    <div class="container">\r\n        <div class="switch">\r\n            <input type="radio" class="switch-input" name="top" value="friends" id="friends" checked >\r\n            <label for="friends" class="switch-label" data-bind="text: linkTopFriends, event: { mouseup: toFriendsTop }"></label>\r\n            <input type="radio" class="switch-input" name="top" value="top" id="top" >\r\n            <label for="top" class="switch-label modetop" data-bind="text: linkTopAll, event: { mouseup: toAllTop }"></label>\r\n            <span class="switch-selection"></span>\r\n        </div>\r\n    </div>\r\n</div>'}),define("text!c/member/view.html",[],function(){return'<li class="member" data-bind="visible: isVisible, click: click, event: { mouseover: function() { hover($data); }, mouseout: out }">\r\n    <!-- ko if: user -->\r\n    <img class="ava" src="" data-bind="attr: { src: user().img, title: user().name }" />\r\n    <img alt="star" src="components/member/star.png" class="star" data-bind="visible: user().place < 3" style="right: 0"/>\r\n    <img alt="star" src="components/member/star.png" class="star" data-bind="visible: user().place < 2" style="right: 16px"/>\r\n    <img alt="star" src="components/member/star.png" class="star" data-bind="visible: user().place < 1" style="right: 32px"/>\r\n    <!-- /ko -->\r\n</li>'}),define("c/member/vm",["ko","text!./view.html","plugins/component","c/info/vm","social/social"],function(e,t,n,r,i){function s(){this.user=e.observable(),this.show=function(e){this.set(e),this.isVisible(!0)},this.set=function(e){e&&e.user&&this.user(e.user)},this.click=function(){if(this.user().id==0){i.invite();return}var e=i.getUserUrl(this.user().id),t=window.open(e,"_blank");t.focus()},this.test=function(){var e=this;require(["controllers/users"],function(t){t.getMe().then(function(t){e.show({user:t})})})},this.hover=function(e){r.show(e.user())},this.out=function(){r.hide()}}return n.add(s,t,"member")}),define("c/top/vm",["ko","text!./view.html","plugins/component","c/member/vm","controllers/users","plugins/localization"],function(e,t,n,r,i,s){function u(e,t){return t.score-e.score}var o=9,a,f={isVisible:e.observable(!1),myself:null,users:e.observableArray(),visibleUsers:e.observableArray(),page:e.observable(0),linkTopFriends:s.linkTopFriends,linkTopAll:s.linkTopAll,show:function(e){this.myself=e,this.toFriendsTop(),this.isVisible(!0)},setVisibleUsers:function(e){a==="friends"&&(e=[this.myself].concat(e)),e.sort(u),e.forEach(function(e,t){e.place=a==="top"?t:undefined}),this.users(e);var t=[];for(var n=this.page()*o,r=0;n<this.users().length&&r<o;n++,r++)t.push(this.users()[n]);for(;n<o;n++)t.push(i.newPlayer());this.visibleUsers(t)},toAllTop:function(){a="top",this.getUsers(i.getTopUsers)},toFriendsTop:function(){a="friends",this.getUsers(i.getFriendsUsers)},getUsers:function(e){var t=this;e().then(function(e){t.setVisibleUsers(e)})},test:function(){var e=this;require(["plugins/loader"],function(e){e.load(e.resources.GAME).then(function(){})}),i.getMe().then(function(t){e.show(t)})}};return n.add(f,t,"top")}),define("text!c/intro/view.html",[],function(){return'<div class="intro" data-bind="visible: isVisible">\r\n    <h1 data-bind="text: header1"></h1>\r\n    <h2 data-bind="text: header2"></h2>\r\n\r\n    <p data-bind="text: desc"></p>\r\n\r\n    <a href="#" class="button" data-bind="click: start">\r\n        <span data-bind="text: btnStart"></span>\r\n    </a>\r\n\r\n    <br/>\r\n\r\n    <a href="#" class="button" data-bind="click: rules">\r\n        <span data-bind="text: btnInstruction"></span>\r\n    </a>\r\n</div>'}),define("c/intro/vm",["ko","text!./view.html","plugins/component","plugins/localization"],function(e,t,n,r){var i,s={header1:r.header1,header2:r.header2,desc:r.introDesc,btnStart:r.btnStart,btnInstruction:r.btnInstruction,show:function(){return this.isVisible(!0),$.Deferred(function(e){i=e})},start:function(){var e=this;setTimeout(function(){i.notify("start")},300)},rules:function(){var e=this;setTimeout(function(){i.notify("rules")},300)},test:function(){require(["plugins/loader"],function(e){e.load(e.resources.GAME).then(function(){})}),this.show().progress(function(e){alert(e)})}};return n.add(s,t,"intro")}),define("text!c/instruction/view.html",[],function(){return'<div class="instruction" data-bind="visible: isVisible">\r\n    <h1 data-bind="text: title">Инструкция</h1>\r\n    <p data-bind="text: rules1">1. Для удара по мячу необходимо зажать левую кнопку мыши на мяче и потянуть в направлении удара, а затем отпустить.</p>\r\n    <p data-bind="text: rules2">2. Для выбора направления прыжка вратаря необходимо зажать левую кнопку мыши на голове вратаря и потянуть в направлении прыжка, а затем отпустить.</p>\r\n    <img alt="" src=""/>\r\n\r\n    <br/>\r\n    <br/>\r\n    <a id="rulelink" target="_blank" data-bind="text: rulePenalty" href="//ru.wikipedia.org/wiki/%D0%9F%D0%BE%D1%81%D0%BB%D0%B5%D0%BC%D0%B0%D1%82%D1%87%D0%B5%D0%B2%D1%8B%D0%B5_%D0%BF%D0%B5%D0%BD%D0%B0%D0%BB%D1%8C%D1%82%D0%B8"></a>\r\n    <br/>\r\n    <br/>\r\n\r\n    <a href="#" class="button" data-bind="click: back">\r\n        <span data-bind="text: prev"></span>\r\n    </a>\r\n</div>'}),define("c/instruction/vm",["ko","text!./view.html","plugins/component","plugins/localization"],function(e,t,n,r){var i,s={title:r.instructionTitle,rules1:r.rules1,rules2:r.rules2,rulePenalty:r.rulePenalty,prev:r.prev,show:function(){return this.isVisible(!0),$.Deferred(function(e){i=e})},back:function(){var e=this;setTimeout(function(){e.isVisible(!1),i.resolve()},300)},test:function(){require(["plugins/loader"],function(e){e.load(e.resources.GAME).then(function(){})}),this.show().then(function(){console.log("back")})}};return n.add(s,t,"instruction")}),define("text!c/choice/view.html",[],function(){return'<div class="choice" data-bind="visible: isVisible">\r\n    <h1 data-bind="text: title"></h1>\r\n    <!-- ko if: items -->\r\n    <ul id="pairs8" data-bind="foreach: items">\r\n        <li data-bind="click: function() { $parent.ok($index()); }">\r\n            <team params="name: \'choice\' + $index(), team: $data"></team>\r\n        </li>\r\n    </ul>\r\n    <!-- /ko -->\r\n</div>'}),define("text!c/team/view.html",[],function(){return'<div class="team" data-bind="visible: isVisible">\r\n    <!-- ko if: team -->\r\n\r\n    <!-- ko if: position() == \'left\' -->\r\n    <div data-bind="css: team().className"></div>\r\n    <span data-bind="text: team().name, css: { \'playerTeam\': team().isPlayer }"></span>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: position() == \'right\' -->\r\n    <span data-bind="text: team().name, css: { \'playerTeam\': team().isPlayer }"></span>\r\n    <div data-bind="css: team().className"></div>\r\n    <!-- /ko -->\r\n\r\n    <!-- /ko -->\r\n</div>'}),define("c/team/vm",["ko","text!./view.html","plugins/component"],function(e,t,n){function r(){this.team=e.observable(),this.position=e.observable("left"),this.show=function(e){this.set(e),this.isVisible(!0)},this.set=function(e){e&&e.team&&this.team(typeof e.team=="function"?e.team():e.team),this.position(e&&e.position?e.position:"left")},this.test=function(){var e=this;require(["model/teams"],function(t){e.show({team:t[0]})})}}return n.add(r,t,"team")}),define("c/choice/vm",["ko","text!./view.html","plugins/component","c/team/vm","plugins/localization","model/teams"],function(e,t,n,r,i,s){var o,u={isVisible:e.observable(!1),items:e.observableArray(s),title:i.choiceTitle,show:function(){return this.isVisible(!0),$.Deferred(function(e){o=e})},ok:function(e){this.isVisible(!1),o.resolve(e)},test:function(){require(["plugins/loader"],function(e){e.load(e.resources.GAME).then(function(){})}),this.show().then(function(e){alert("Selected team is "+e)})}};return n.add(u,t,"choice")}),define("text!c/tournament/view.html",[],function(){return'<div class="tournament" data-bind="visible: isVisible">\r\n    <div id="tournament-table">\r\n        <img alt="" src="components/tournament/table.png"/>\r\n    </div>\r\n    <!-- ko if: rounds()[0] -->\r\n    <team id="t00" class="t t0" params="name: \'tournament\' + 0, team: teams[rounds()[0][0].teamA]"></team>\r\n    <team id="t01" class="t t0" params="name: \'tournament\' + 1, team: teams[rounds()[0][0].teamB]"></team>\r\n    <team id="t02" class="t t0" params="name: \'tournament\' + 2, team: teams[rounds()[0][1].teamA]"></team>\r\n    <team id="t03" class="t t0" params="name: \'tournament\' + 3, team: teams[rounds()[0][1].teamB]"></team>\r\n    <team id="t04" class="t t0" params="name: \'tournament\' + 4, team: teams[rounds()[0][2].teamA]"></team>\r\n    <team id="t05" class="t t0" params="name: \'tournament\' + 5, team: teams[rounds()[0][2].teamB]"></team>\r\n    <team id="t06" class="t t0" params="name: \'tournament\' + 6, team: teams[rounds()[0][3].teamA]"></team>\r\n    <team id="t07" class="t t0" params="name: \'tournament\' + 7, team: teams[rounds()[0][3].teamB]"></team>\r\n    <team id="t08" class="t t0" params="name: \'tournament\' + 8, team: teams[rounds()[0][4].teamA]"></team>\r\n    <team id="t09" class="t t0" params="name: \'tournament\' + 9, team: teams[rounds()[0][4].teamB]"></team>\r\n    <team id="t010" class="t t0" params="name: \'tournament\' + 10, team: teams[rounds()[0][5].teamA]"></team>\r\n    <team id="t011" class="t t0" params="name: \'tournament\' + 11, team: teams[rounds()[0][5].teamB]"></team>\r\n    <team id="t012" class="t t0" params="name: \'tournament\' + 12, team: teams[rounds()[0][6].teamA]"></team>\r\n    <team id="t013" class="t t0" params="name: \'tournament\' + 13, team: teams[rounds()[0][6].teamB]"></team>\r\n    <team id="t014" class="t t0" params="name: \'tournament\' + 14, team: teams[rounds()[0][7].teamA]"></team>\r\n    <team id="t015" class="t t0" params="name: \'tournament\' + 15, team: teams[rounds()[0][7].teamB]"></team>\r\n    <p id="t0score0" class="s t0score" data-bind="text: rounds()[0][0].score"></p>\r\n    <p id="t0score1" class="s t0score" data-bind="text: rounds()[0][1].score"></p>\r\n    <p id="t0score2" class="s t0score" data-bind="text: rounds()[0][2].score"></p>\r\n    <p id="t0score3" class="s t0score" data-bind="text: rounds()[0][3].score"></p>\r\n    <p id="t0score4" class="s t0score" data-bind="text: rounds()[0][4].score"></p>\r\n    <p id="t0score5" class="s t0score" data-bind="text: rounds()[0][5].score"></p>\r\n    <p id="t0score6" class="s t0score" data-bind="text: rounds()[0][6].score"></p>\r\n    <p id="t0score7" class="s t0score" data-bind="text: rounds()[0][7].score"></p>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: rounds()[1] -->\r\n    <team id="t10" class="t t1" params="name: \'tournament\' + 16, team: teams[rounds()[1][0].teamA]"></team>\r\n    <team id="t11" class="t t1" params="name: \'tournament\' + 17, team: teams[rounds()[1][0].teamB]"></team>\r\n    <team id="t12" class="t t1" params="name: \'tournament\' + 18, team: teams[rounds()[1][1].teamA]"></team>\r\n    <team id="t13" class="t t1" params="name: \'tournament\' + 19, team: teams[rounds()[1][1].teamB]"></team>\r\n    <team id="t14" class="t t1" params="name: \'tournament\' + 20, team: teams[rounds()[1][2].teamA]"></team>\r\n    <team id="t15" class="t t1" params="name: \'tournament\' + 21, team: teams[rounds()[1][2].teamB]"></team>\r\n    <team id="t16" class="t t1" params="name: \'tournament\' + 22, team: teams[rounds()[1][3].teamA]"></team>\r\n    <team id="t17" class="t t1" params="name: \'tournament\' + 23, team: teams[rounds()[1][3].teamB]"></team>\r\n    <p id="t1score0" class="s t1score" data-bind="text: rounds()[1][0].score"></p>\r\n    <p id="t1score1" class="s t1score" data-bind="text: rounds()[1][1].score"></p>\r\n    <p id="t1score2" class="s t1score" data-bind="text: rounds()[1][2].score"></p>\r\n    <p id="t1score3" class="s t1score" data-bind="text: rounds()[1][3].score"></p>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: rounds()[2] -->\r\n    <team id="t20" class="t t2" params="name: \'tournament\' + 24, team: teams[rounds()[2][0].teamA]"></team>\r\n    <team id="t21" class="t t2" params="name: \'tournament\' + 25, team: teams[rounds()[2][0].teamB]"></team>\r\n    <team id="t22" class="t t2" params="name: \'tournament\' + 26, team: teams[rounds()[2][1].teamA]"></team>\r\n    <team id="t23" class="t t2" params="name: \'tournament\' + 27, team: teams[rounds()[2][1].teamB]"></team>\r\n    <p id="t2score0" class="s t2score" data-bind="text: rounds()[2][0].score"></p>\r\n    <p id="t2score1" class="s t2score" data-bind="text: rounds()[2][1].score"></p>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: rounds()[3] -->\r\n    <team id="t30" class="t t3" params="name: \'tournament\' + 28, team: teams[rounds()[3][0].teamA]"></team>\r\n    <team id="t31" class="t t3" params="name: \'tournament\' + 29, team: teams[rounds()[3][0].teamB]"></team>\r\n    <p id="t3score0" class="s t3score" data-bind="text: rounds()[3][0].score"></p>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: champion() >= 0 -->\r\n    <team id="champion" class="t" params="name: \'tournament\' + 30, team: teams[champion()]"></team>\r\n    <!-- /ko -->\r\n\r\n    <div id="go-round">\r\n        <a href="#" class="push_button blue small" data-bind="text: txtGoRound, visible: isGoRoundButtonVisible, click: goRound"></a>\r\n    </div>\r\n\r\n</div>'}),define("c/tournament/vm",["ko","text!./view.html","plugins/component","c/team/vm","plugins/localization","model/teams"],function(e,t,n,r,i,s){function u(e,t){return Math.random()*(t-e)+e|0}function a(){var t=[],n=[],r,i,o,a,f,l;for(l=0;l<s.length;l++)n.push(l);while(n.length>0)r=u(0,n.length),o=n[r],n.splice(r,1),i=u(0,n.length),a=n[i],n.splice(i,1),f={teamA:o,teamB:a,score:e.observable("-:-")},t.push(f);return t}function f(e){var t=0;for(var n=0;n<5;n++)u(0,10+e)>4&&t++;return t}function l(e,t,n){e.score(""+t+":"+n),e.winner=t>n?e.teamA:e.teamB}var o,c,h,p={isGoRoundButtonVisible:e.observable(!1),rounds:e.observableArray(),teams:s,champion:e.observable(-1),txtGoRound:i.txtGoRound,show:function(e){return c=0,h=e,this.isVisible(!0),this.isGoRoundButtonVisible(!0),this.rounds.push(a()),$.Deferred(function(e){o=e})},goRound:function(){var e=this;this.isGoRoundButtonVisible(!1);var t=this.rounds()[c],n={round:c};for(var r=0;r<t.length;r++){var i=t[r];if(h===i.teamA||h===i.teamB)n.pair=i,this.isVisible(!1),o.notify("match",n);else{var u=s[i.teamA],a=s[i.teamB],p=f(u.power-a.power),d=f(a.power-u.power);p===d&&(u.power-a.power>0?p++:d++),l(i,p,d)}}},matchEnded:function(e){this.isVisible(!0),l(e.pair,e.goalsA,e.goalsB),this.setNewTeamPairs();if(e.pair.winner!==h){var t;switch(c){case 0:t=16;break;case 1:t=8;break;case 2:t=4;break;case 3:t=2}this.isVisible(!1),o.notify("end",t)}},setNewTeamPairs:function(){var t=[],n=this.rounds()[c];if(c===3){var r=n[0].winner;r===h&&(this.isVisible(!1),o.notify("end",1)),this.champion(r);return}for(var i=0;i<n.length;i+=2){var s={teamA:n[i].winner,teamB:n[i+1].winner,score:e.observable("-:-")};t.push(s)}this.rounds.push(t),this.isGoRoundButtonVisible(!0),c++},test:function(){var e=this;require(["plugins/loader"],function(e){e.load(e.resources.GAME).then(function(){})}),require(["plugins/options"],function(t){t.init(5),e.show(5).progress(function(t,n){console.log(t+": "+JSON.stringify(n)),t==="match"?(n.goals1=5,n.goals2=2,e.isVisible(!0),setTimeout(function(){e.matchEnded(n)})):t==="end"&&alert("Your place is "+n)})})}};return n.add(p,t,"tournament")}),define("text!c/match/view.html",[],function(){return'<div class="match" data-bind="visible: isVisible">\r\n\r\n    <br/>\r\n    <br/>\r\n    <br/>\r\n\r\n    <div class="teams">\r\n        <!-- ko if: teamA() >= 0 -->\r\n        <team params="name: \'match1\', team: teams[teamA()]"></team>\r\n        <!-- /ko -->\r\n        <p>VS</p>\r\n        <!-- ko if: teamB() >= 0 -->\r\n        <team params="name: \'match2\', team: teams[teamB()]"></team>\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n    <h2 data-bind="text: firstTurn">Право первого удара: </h2>\r\n    <a href="#" class="push_button blue small" data-bind="text: drawLot, visible: isBallotVisible, click: ballot"></a>\r\n    <!-- ko if: firstTeam() >= 0 -->\r\n    <team params="name: \'match3\', team: teams[firstTeam()]"></team>\r\n    <!-- /ko -->\r\n\r\n    <br/>\r\n    <br/>\r\n    <br/>\r\n\r\n    <a href="#" class="button" data-bind="visible: isBeginVisible, click: beginGame">\r\n        <span data-bind="text: btnStart"></span>\r\n    </a>\r\n\r\n</div>'}),define("c/match/vm",["ko","text!./view.html","plugins/component","c/team/vm","plugins/localization","model/teams"],function(e,t,n,r,i,s){function o(e,t){return Math.random()*(t-e)+e|0}var u,a={isBallotVisible:e.observable(!0),isBeginVisible:e.observable(!1),teamA:e.observable(-1),teamB:e.observable(-1),firstTeam:e.observable(-1),teams:s,firstTurn:i.firstTurn,drawLot:i.drawLot,btnStart:i.btnStart,show:function(e,t){return this.isBallotVisible(!0),this.isBeginVisible(!1),this.firstTeam(-1),this.teamA(-1),this.teamB(-1),this.teamA(e),this.teamB(t),this.isVisible(!0),$.Deferred(function(e){u=e})},beginGame:function(){this.isVisible(!1),u.resolve(this.firstTeam())},ballot:function(){this.isBeginVisible(!0),this.isBallotVisible(!1),this.firstTeam(o(0,2)===0?this.teamA():this.teamB())},test:function(){var e=this;require(["plugins/loader"],function(e){e.load(e.resources.GAME).then(function(){})}),e.show(1,2).then(function(e){alert("First turn team is "+e)})}};return n.add(a,t,"match")}),define("text!c/load/view.html",[],function(){return'<div class="load" data-bind="visible: isVisible">\r\n    <div class="loading">\r\n    <progress max="100" data-bind="attr: { value: percent }" class="css3">\r\n    </progress>\r\n    <a href="#" class="button" data-bind="click: start, visible: isLoaded">\r\n        <span data-bind="text: buttonName"></span>\r\n    </a>\r\n    </div>\r\n</div>'}),define("c/load/vm",["ko","text!./view.html","plugins/component","jquery","plugins/localization"],function(e,t,n,r,i){var s,o={isLoaded:e.observable(!1),percent:e.observable(0),buttonName:i.btnStart,show:function(){this.percent(0),this.isVisible(!0),this.isLoaded(!1);var e=this;return r.Deferred(function(e){s=e})},onPercentChanged:function(e){this.percent(e),e===100&&this.isLoaded(!0)},start:function(){this.isVisible(!1),s.resolve()},test:function(){function n(){t.onPercentChanged(e),e<100&&window.setTimeout(n,10),e++}this.show().then(function(){console.log("Finish")});var e=0,t=this;n()}};return n.add(o,t,"load")}),define("text!c/game/view.html",[],function(){return'<div class="game" data-bind="visible: isVisible">\r\n\r\n    <scores></scores>\r\n\r\n    <div class="meta" data-bind="visible: isVisibleMeta">\r\n        <h1 data-bind="text: text"></h1>\r\n    </div>\r\n\r\n    <twist></twist>\r\n    <psychic></psychic>\r\n\r\n    <canvas id="viewport"></canvas>\r\n</div>\r\n'}),define("text!c/scores/view.html",[],function(){return'<div class="scores" data-bind="visible: isVisible">\r\n\r\n    <!-- ko if: teamA() && teamB() -->\r\n    <div class="score">\r\n        <team params="name: \'scores1\', team: teamA(), position: \'right\'"></team>\r\n        <span class="value" data-bind="text: \'\' + goalsA() + \':\' + goalsB()"></span>\r\n        <team params="name: \'scores2\', team: teamB(), position: \'left\'"></team>\r\n    </div>\r\n    <div class="stats">\r\n        <div class="round">\r\n            <div data-bind="css: teamA().className"></div>\r\n            <div data-bind="css: teamB().className"></div>\r\n        </div>\r\n        <!-- ko foreach: rounds -->\r\n        <div class="round">\r\n            <div data-bind="css: A"></div>\r\n            <div data-bind="css: B"></div>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n</div>\r\n'}),define("c/scores/vm",["ko","text!./view.html","plugins/component","c/team/vm","plugins/localization"],function(e,t,n,r,i){function f(e,t){return Math.random()*(t-e)+e|0}var s,o,u,a,l={teamA:e.observable(null),teamB:e.observable(null),goalsA:e.observable(0),goalsB:e.observable(0),rounds:e.observableArray([]),getRound:function(){return this.rounds.length},getMoveTeamAB:function(){return o},newRound:function(){a={A:e.observable("none"),B:e.observable("none")},this.rounds.push(a)},show:function(e,t,n,r){u=n,o=r,s=1,this.rounds([]),this.teamA(null),this.teamB(null),this.goalsA(0),this.goalsB(0),this.teamA(e),this.teamB(t),this.newRound(),a[o]("move"),this.isVisible(!0)},next:function(e){a[o](e?"goal":"miss"),s%2===0&&this.newRound(),e&&(o==="A"?this.goalsA(this.goalsA()+1):this.goalsB(this.goalsB()+1));if(s>=10&&s%2===0&&Math.abs(this.goalsA()-this.goalsB())>0){var t=u=="A"?this.goalsA()>this.goalsB()?i.txtWin():i.txtDefeat():this.goalsA()>this.goalsB()?i.txtDefeat():i.txtWin();return t}return s++,o=o==="A"?"B":"A",a[o]("move"),null},test:function(){var e=this;require(["plugins/options"],function(t){e.show(t.teams[2],t.teams[3],"A","A"),$(".score").css("background-color","grey");var n=setInterval(function(){var t=e.next(f(0,2)===1);t&&(clearInterval(n),alert("result"))},1e3)})}};return n.add(l,t,"scores")}),define("text!c/psychic/view.html",[],function(){return'<div class="psychic" data-bind="visible: isVisible() && isPaymentEnabled">\r\n\r\n    <img alt="" src="components/psychic/psychic.png" data-bind="click: buy, event: { mouseover: hover, mouseout: out }, css: { enabled: isEnabled }" />\r\n    <div class="text" data-bind="text: text, visible: textVisible() && !isEnabled()"></div>\r\n    <div class="text bought" data-bind="text: textEnabled, visible: textVisible() && isEnabled()"></div>\r\n\r\n</div>\r\n'}),define("c/psychic/vm",["ko","text!./view.html","plugins/component","plugins/localization","social/social"],function(e,t,n,r,i){var s={isPaymentEnabled:window.cfg.payments,textVisible:e.observable(!1),text:r.psychicText,isEnabled:e.observable(!1),textEnabled:r.psychicTextEnabled,show:function(){this.isVisible(!0),this.isEnabled(!1)},buy:function(){if(this.isEnabled()===!0)return;var e=this;i.showOrderBox().then(function(){e.isEnabled(!0),e.onHired&&e.onHired()})},onHired:null,hover:function(){this.textVisible(!0)},out:function(){this.textVisible(!1)},test:function(){this.show()}};return n.add(s,t,"psychic")}),define("text!c/twist/view.html",[],function(){return'<div class="twist" data-bind="visible: isVisible">\r\n\r\n    <h4 data-bind="text: txtTwistBall"></h4>\r\n    <img alt="" src="components/twist/brazuca.png" />\r\n    <input class="twistvalue" type="range" min="-10" max="10" value="0" data-bind="value: twistvalue">\r\n\r\n</div>\r\n'}),define("c/twist/vm",["ko","text!./view.html","plugins/component","plugins/localization"],function(e,t,n,r){var i={twistvalue:e.observable(0),txtTwistBall:r.txtTwistBall,show:function(){this.isVisible(!0)},hide:function(){this.isVisible(!1)},test:function(){this.show()}};return n.add(i,t,"twist")}),define("engine/friction",["physics"],function(e){function t(e){var t=e.x,n=e.y;return Math.sqrt(t*t+n*n)}var n=1e-5;e.behavior("friction",function(e){var r={koeff:.001,angKoeff:.002};return{init:function(t){e.init.call(this),this.options.defaults(r),this.options(t),this._koeff=this.options.koeff,this._angKoeff=this.options.angKoeff},behave:function(e){var r=this.getTargets();for(var i=0,s=r.length;i<s;++i){var o=r[i],u=o.class==="goalkeeper"?this._koeff*10:this._koeff,a=o.state.vel.clone().mult(u);t(a)<n&&(a=o.state.vel.clone()),o.state.vel.vsub(a);var f=o.state.angular.vel,l,c=o.class==="goalkeeper"?this._angKoeff*10:this._angKoeff;f>0?(l=c*f,f-=l,f<0&&(f=0)):f<0&&(l=c*f,f-=l,f>0&&(f=0)),o.state.angular.vel=f}}}})}),define("engine/twist",["physics"],function(e){function t(e){var t=e.x,n=e.y;return Math.sqrt(t*t+n*n)}var n=1e-5;e.behavior("twist",function(t){var n={koeff:.1};return{init:function(e){t.init.call(this),this.options.defaults(n),this.options(e),this._koeff=this.options.koeff},behave:function(t){var n=t.bodies,r=this;n.forEach(function(t){if(t.name!=="ball"||!t.strikeVector)return;var n=t.state.angular.vel,i=new e.vector(n*r._koeff,0);t.state.vel.vadd(i)})}}})}),define("engine/viewport",["physics","jquery","engine/friction","engine/twist"],function(e,t,n){return{init:function(n,r){return t.Deferred(function(t){e({timestep:2},function(i){var s=e.renderer("canvas",{el:"viewport",width:n,height:r,meta:!1}),o=s.layer("main");i.add(s),o.options.offset=new e.vector(0,0),s.addLayer("top",undefined,{manual:!0,zIndex:1e3}),i.add([e.behavior("friction"),e.behavior("twist"),e.behavior("body-impulse-response"),e.behavior("body-collision-detection"),e.behavior("sweep-prune")]),i.on("step",function(e){i.render()}),e.util.ticker.on(function(e){i.step(e)}),i.getTopLayer=function(){return s.layer("top")},i.getOffset=function(){return o.options.offset},i.getPosRel=function(t){return(new e.vector(t)).vadd(i.getOffset())},i.getPosAbs=function(t){return(new e.vector(t)).vsub(i.getOffset())},i.getVectorLength=function(t){return(new e.vector(t)).vsub(i.getOffset())},i.getLength=function(e){var t=e.x,n=e.y;return Math.sqrt(t*t+n*n)},i.clearLayer=function(e){var t=i._renderer.layer(e),s=t.ctx;s.clearRect(0,0,n,r)},t.resolve(i)})})}}}),define("engine/points",["physics"],function(e){return{PenaltyBall:new e.vector(355,765),LeftCrossbar:new e.vector(70,45),RightCrossbar:new e.vector(626,45),LeftGate:new e.vector(70,-25),RightGate:new e.vector(626,-25),TopGate:new e.vector(348,-105),GateOffset:new e.vector(63,-88),GoalkeeperStart:new e.vector(350,100)}}),define("engine/background",["jquery","physics","engine/points","plugins/loader"],function(e,t,n,r){var i=!1;return{xPrev:-1,yPrev:-1,init:function(e){var t=e._renderer,s=t.addLayer("background",undefined,{manual:!0}),o=t.addLayer("gate",undefined,{manual:!0,zIndex:5}),u=r.getFile("field").image$,a=r.getFile("gate").image$;e.on("render",function(e){if(i)return;s.ctx.drawImage(u[0],0,0),o.ctx.drawImage(a[0],n.GateOffset.x,n.GateOffset.y),i=!0})}}}),define("engine/ball",["jquery","physics","engine/points","plugins/loader"],function(e,t,n,r){function i(e,t){return Math.random()*(t-e)+e|0}function s(e){var n=o[e];return(new t.vector(n[i(0,n.length)])).mult(u)}function v(){p.ball&&p.remove(p.ball);var e=t.body("circle",{x:0,y:0,radius:f,mass:l,cof:h,restitution:c});return e.view=d[0],e.name="ball",p.add(e),p.ball=e,e}var o=[[{x:-69,y:-187},{x:0,y:-200},{x:69,y:-187},{x:-50,y:-180},{x:-25,y:-190},{x:-10,y:-187},{x:50,y:-180},{x:25,y:-190},{x:10,y:-187},{x:-50,y:-160},{x:-25,y:-170},{x:-10,y:-157},{x:50,y:-160},{x:25,y:-170},{x:10,y:-157},{x:-75,y:-187},{x:75,y:-187},{x:-95,y:-217},{x:95,y:-217}],[{x:-69,y:-187},{x:0,y:-200},{x:69,y:-187},{x:-50,y:-180},{x:-25,y:-190},{x:-10,y:-187},{x:50,y:-180},{x:25,y:-190},{x:10,y:-187},{x:-50,y:-160},{x:-25,y:-170},{x:-10,y:-157},{x:50,y:-160},{x:25,y:-170},{x:10,y:-157},{x:-75,y:-187},{x:75,y:-187}],[{x:-69,y:-187},{x:0,y:-200},{x:69,y:-187},{x:-50,y:-180},{x:-25,y:-190},{x:-10,y:-187},{x:50,y:-180},{x:25,y:-190},{x:10,y:-187},{x:-50,y:-160},{x:-25,y:-170},{x:-10,y:-157},{x:50,y:-160},{x:25,y:-170},{x:10,y:-157}],[{x:-69,y:-187},{x:0,y:-200},{x:69,y:-187},{x:-50,y:-180},{x:-25,y:-190},{x:50,y:-180},{x:25,y:-190}]],u=.005,a=.005,f=12,l=1,c=.9,h=.5,p,d;return{getRandomVector:function(){return s(p.round)},toStart:function(){var e=v();e.state.pos.x=n.PenaltyBall.x+i(0,10)-5,e.state.pos.y=n.PenaltyBall.y+i(0,10)-5,p.clearLayer("ball")},strike:function(e,n){var r;if(p.isAttack){var s=(new t.vector(i(0,10)-5,i(0,10)-5)).mult(a);r=e.clone().mult(u).vadd(s)}else r=n||this.getRandomVector();p.ball.accelerate(r),p.ball.strikeVector=r},init:function(e){p=e,d=r.getFile("ball").image$;var t=e._renderer.addLayer("ball",undefined,{manual:!0,zIndex:2}),n=e._renderer.layer("ball").ctx;e.on("render",function(t){e.ball&&e.ball.oldPos===undefined&&(e.ball.oldPos=e.ball.state.pos.clone());if(e.state==="strike"&&e.ball&&e.ball.oldPos){var r=e.getPosRel(e.ball.state.pos),i=e.getLength(r.vsub(e.ball.oldPos));if(i<20)return;n.globalAlpha=.2,n.beginPath(),n.arc(e.ball.oldPos.x,e.ball.oldPos.y,12,0,2*Math.PI,!1),n.fillStyle="#fff",n.fill(),n.closePath(),n.globalAlpha=1,e.ball.oldPos=e.ball.state.pos.clone()}})}}}),define("engine/objects",["jquery","physics","engine/points"],function(e,t,n){var r=.1,i=560,s=7,o=.1,u=!0;return{init:function(e){var i=t.body("circle",{x:n.LeftCrossbar.x,y:n.LeftCrossbar.y,radius:s,cof:o,restitution:r,hidden:u}),a=t.body("circle",{x:n.RightCrossbar.x,y:n.RightCrossbar.y,radius:s,cof:o,restitution:r,hidden:u}),f=t.body("rectangle",{x:n.LeftGate.x,y:n.LeftGate.y,width:3,height:135,cof:o,restitution:r,hidden:u}),l=t.body("rectangle",{x:n.RightGate.x,y:n.RightGate.y,width:3,height:135,cof:o,restitution:r,hidden:u}),c=t.body("rectangle",{x:n.TopGate.x,y:n.TopGate.y,width:559,height:3,cof:o,restitution:r,hidden:u});i.treatment="static",a.treatment="static",f.treatment="static",l.treatment="static",c.treatment="static",i.name=a.name="crossbar",e.add(i),e.add(a),e.add(f),e.add(l),e.add(c),e.on("step",function(){if(e.state!=="strike"&&e.state!=="hand"&&e.state!=="crossbar")return;var t=e.ball;if(t.state.vel.y>0&&t.state.pos.y>i.state.pos.y+200)e.emit("ball:stop");else if(t.state.vel.x===0&&t.state.vel.y===0||t.state.pos.y<0)e.emit("ball:stop");else{var n=t.state.pos;n.x>i.state.pos.x&&n.x<a.state.pos.x&&n.y<i.state.pos.y&&e.emit("goal")}})}}}),define("engine/Points",["physics"],function(e){return{PenaltyBall:new e.vector(355,765),LeftCrossbar:new e.vector(70,45),RightCrossbar:new e.vector(626,45),LeftGate:new e.vector(70,-25),RightGate:new e.vector(626,-25),TopGate:new e.vector(348,-105),GateOffset:new e.vector(63,-88),GoalkeeperStart:new e.vector(350,100)}}),define("engine/arrow",["jquery","physics"],function(e,t){function u(e){var t=e.x,n=e.y;return Math.sqrt(t*t+n*n)}function a(e,t){e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(p in t)p>0&&e.lineTo(t[p][0],t[p][1]);e.lineTo(t[0][0],t[0][1]),e.fill()}function f(e,t,n){var r=[];for(p in e)r.push([e[p][0]+t,e[p][1]+n]);return r}function l(e,t){var n=[];for(p in e)n.push(c(t,e[p][0],e[p][1]));return n}function c(e,t,n){return[t*Math.cos(e)-n*Math.sin(e),t*Math.sin(e)+n*Math.cos(e)]}function h(e,t,i,s){e.strokeStyle="#000000",e.globalAlpha=o,s!=null&&(e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(s.x,s.y),e.lineWidth=r,e.stroke());var u=Math.atan2(i.y-t.y,i.x-t.x);a(e,f(l(n,u),i.x,i.y)),e.globalAlpha=1}function d(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{left:t,top:n}}function v(e){var t=d(e.target),n=e.changedTouches&&e.changedTouches[0]||e,r=n.pageX-t.left,i=n.pageY-t.top;return{x:r,y:i}}function m(e,t){return e.clone().normalize().mult(t)}var n=[[-20,-25],[-20,25],[10,0]],r=24,i=20,s=200,o=.4;return{strikeVector:null,drawPsychicArrow:function(e,t){var n=e._renderer.layer("arrow"),r=e.isAttack?e.goalkeeper.head.state.pos:e.ball.state.pos,o;e.isAttack?o=e.ball.state.pos.clone().vadd(t.clone().normalize().mult(650)):o=e.ball.state.pos.clone().vadd(t.clone().normalize().mult(s));var u=e.getPosRel(r),a=e.getPosRel(o),f=o.clone().vsub(r),l=f.clone().normalize().mult(i),c=o.clone().vsub(l),p=e.getPosRel(c);h(n.ctx,u,a,p)},init:function(e){var n=e._renderer.addLayer("arrow",undefined,{manual:!0,zIndex:10}),r=e.getTopLayer(),o=null,a=null,f=this,l=!1,c=!1,p=function(n){var r=e.ball.geometry.radius,i=e.goalkeeper.head.geometry.radius;e.ball.geometry.radius=100,e.goalkeeper.head.geometry.radius=100;var s=e.getPosAbs(new t.vector(v(n))),u=e.findOne({$at:s});e.ball.geometry.radius=r,e.goalkeeper.head.geometry.radius=i;if(!u)return;e.isAttack&&u==e.ball?(o=e.ball.state.pos.clone(),c=!0):!e.isAttack&&u===e.goalkeeper.head&&(o=e.goalkeeper.head.state.pos.clone(),c=!0)},d=function(n){c&&(n.preventDefault(),a=e.getPosAbs(new t.vector(v(n))))},g=function(t){c===!0&&e.state==="start"&&(c=!1,e.emit("arrow:ready"))};r.el.addEventListener("mousedown",p),r.el.addEventListener("touchstart",p),r.el.addEventListener("mousemove",d),r.el.addEventListener("touchmove",d),r.el.addEventListener("mouseup",g),r.el.addEventListener("touchend",g),e.on("render",function(t){if(e.state!=="start"){l===!1&&(n.ctx.clearRect(0,0,n.el.width,n.el.height),l=!0,o=null,a=null,c=!1);return}if(o===null||a===null||e.state!=="start")return;var r=a.clone().vsub(o),p=null,d=null,v=u(r);if(v>s){var g=v-s,y=r.clone().normalize().mult(g);a.vsub(y),f.strikeVector=m(r,s)}else f.strikeVector=m(r,v);if(v>i){var b=r.clone().normalize().mult(i);p=a.clone().vsub(b)}var w=e.getPosRel(o),E=e.getPosRel(a);p&&(d=e.getPosRel(p)),n.ctx.clearRect(w.x-250,w.y-250,E.x+250,E.y+250),h(n.ctx,w,E,d),l===!0&&(l=!1)})}}}),define("engine/goalkeeper",["jquery","physics","engine/points","plugins/loader"],function(e,t,n,r){function o(e,t){return Math.random()*(t-e)+e|0}function k(){if(E.state==="strike")return;var e=n.GoalkeeperStart.x,r=n.GoalkeeperStart.y;S.head.state.pos.x>=e?S.leftHand.accelerate(new t.vector(-h,0)):S.head.state.pos.x<e&&S.rightHand.accelerate(new t.vector(h,0)),S.head.state.pos.y>=r?S.back.accelerate(new t.vector(0,-h*.1)):S.head.state.pos.y<r&&S.back.accelerate(new t.vector(0,h*.1))}function L(){E.goalkeeper&&(E.remove(E.goalkeeper.head),E.remove(E.goalkeeper.leftHand),E.remove(E.goalkeeper.rightHand),E.remove(E.goalkeeper.back));var e=t.body("circle",{x:n.GoalkeeperStart.x,y:n.GoalkeeperStart.y,radius:a,mass:f,cof:c,restitution:l}),r=t.body("circle",{x:n.GoalkeeperStart.x-d,y:n.GoalkeeperStart.y,radius:15,mass:f,cof:c,restitution:l}),s=t.body("circle",{x:n.GoalkeeperStart.x+d,y:n.GoalkeeperStart.y,radius:15,mass:f,cof:c,restitution:l}),o=t.body("circle",{x:n.GoalkeeperStart.x,y:n.GoalkeeperStart.y-d,radius:p,mass:f,cof:c,restitution:l,hidden:!0});S={head:e,leftHand:r,rightHand:s,back:o},i===!0&&(e.view=x[0],r.view=T[0],s.view=N[0]),r.name=s.name="hand",o.class=e.class=r.class=s.class="goalkeeper";var u=t.behavior("verlet-constraints",{iterations:3});u.distanceConstraint(e,r,.2),u.distanceConstraint(e,s,.2),u.distanceConstraint(r,o,.01),u.distanceConstraint(s,o,.01),u.distanceConstraint(e,o,.01),E.add(e),E.add(r),E.add(s),E.add(o),E.add(u),E.goalkeeper=S}var i=!0,s,u=.0015,a=30,f=100,l=.1,c=.1,h=.1,p=5,d=50,v=.0085,m=650,g=[{x:50,y:0},{x:25,y:-25},{x:-25,y:-25},{x:-50,y:0},{x:0,y:50}],y=[{x:-15,y:2},{x:-15,y:-2},{x:30,y:-2},{x:30,y:2}],b=[{x:15,y:2},{x:15,y:-2},{x:-30,y:-2},{x:-30,y:2}],w=[{x:-25,y:0},{x:0,y:-15},{x:25,y:0},{x:0,y:15}],E,S,x,T,N,C=0;return{toStart:function(){L(),s=!0,E.clearLayer("goalkeeper")},"catch":function(){var e=E.ball.state.vel,t=e.clone().mult(.9);E.ball.state.vel.vsub(t)},jump:function(e,n,r){var i,s;if(E.isAttack){E.round===0||r?e=n:E.round===1?(s=new t.vector(o(5,25),0),e.x<0?e.vadd(s):e.vsub(s)):E.round===2?(s=new t.vector(o(5,18),0),e.x<0?e.vadd(s):e.vsub(s)):E.round===3&&(s=new t.vector(o(0,15),0),e.x<0?e.vadd(s):e.vsub(s));var u=E.getVectorLength(e),a=S.head.state.pos,f=E.ball.state.pos.clone().vadd(e.clone().normalize().mult(m));i=f.vsub(a).mult(v)}else{var l=E.ball.strikeVector,a=S.head.state.pos,f=E.ball.state.pos.clone().vadd(l.clone().normalize().mult(m)),c=e.mult(v);i=c}i.x<0?S.leftHand.accelerate(i):i.x>0&&S.rightHand.accelerate(i)},action:function(e){var r=e.goalkeeper.state.pos.x-n.GoalkeeperStart.x,i=Math.abs(r);switch(o(0,2)){case 0:if(r>0&&o(0,i)<i){e.action(e);return}e.rightHand.accelerate(new t.vector(h,0));break;case 1:if(r<0&&o(0,i)<i){e.action(e);return}e.leftHand.accelerate(new t.vector(-h,0))}},init:function(e){E=e;var t=e._renderer.addLayer("goalkeeper",undefined,{manual:!0,zIndex:1});x=r.getFile("head").image$,T=r.getFile("leftHand").image$,N=r.getFile("rightHand").image$;var n=this;e.on("render",function(n){C++,C===10&&(C=0,k());if(S==undefined)return;var r=e.getPosRel(S.head.state.pos),i=e.getPosRel(S.leftHand.state.pos),o=e.getPosRel(S.rightHand.state.pos),u=t.ctx;s?(u.clearRect(0,0,t.el.width,t.el.height),s=!1):u.clearRect(i.x-100,i.y-150,o.x+100,o.y+150),u.strokeStyle="#000000",u.beginPath(),u.moveTo(r.x-a+10,r.y-1),u.lineTo(i.x+10,i.y-3),u.lineWidth=8,u.stroke(),u.beginPath(),u.moveTo(r.x+a-10,r.y-1),u.lineTo(o.x-10,o.y-3),u.lineWidth=8,u.stroke()})}}}),void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var TWEEN=TWEEN||function(){var e=[];return{REVISION:"12",getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){t=e.indexOf(t),-1!==t&&e.splice(t,1)},update:function(t){if(0===e.length)return!1;for(var n=0,t=void 0!==t?t:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();n<e.length;)e[n].update(t)?n++:e.splice(n,1);return!0}}}();TWEEN.Tween=function(e){var t={},n={},r={},i=1e3,s=0,o=!1,u=!1,a=0,f=null,l=TWEEN.Easing.Linear.None,c=TWEEN.Interpolation.Linear,h=[],p=null,d=!1,v=null,m=null,g;for(g in e)t[g]=parseFloat(e[g],10);this.to=function(e,t){return void 0!==t&&(i=t),n=e,this},this.start=function(i){TWEEN.add(this),u=!0,d=!1,f=void 0!==i?i:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),f+=a;for(var s in n){if(n[s]instanceof Array){if(0===n[s].length)continue;n[s]=[e[s]].concat(n[s])}t[s]=e[s],0==t[s]instanceof Array&&(t[s]*=1),r[s]=t[s]||0}return this},this.stop=function(){return u?(TWEEN.remove(this),u=!1,this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var e=0,t=h.length;e<t;e++)h[e].stop()},this.delay=function(e){return a=e,this},this.repeat=function(e){return s=e,this},this.yoyo=function(e){return o=e,this},this.easing=function(e){return l=e,this},this.interpolation=function(e){return c=e,this},this.chain=function(){return h=arguments,this},this.onStart=function(e){return p=e,this},this.onUpdate=function(e){return v=e,this},this.onComplete=function(e){return m=e,this},this.update=function(u){var g;if(u<f)return!0;!1===d&&(null!==p&&p.call(e),d=!0);var y=(u-f)/i,y=1<y?1:y,E=l(y);for(g in n){var S=t[g]||0,x=n[g];x instanceof Array?e[g]=c(x,E):("string"==typeof x&&(x=S+parseFloat(x,10)),"number"==typeof x&&(e[g]=S+(x-S)*E))}null!==v&&v.call(e,E);if(1==y){if(!(0<s)){null!==m&&m.call(e),g=0;for(y=h.length;g<y;g++)h[g].start(u);return!1}isFinite(s)&&s--;for(g in r)"string"==typeof n[g]&&(r[g]+=parseFloat(n[g],10)),o&&(y=r[g],r[g]=n[g],n[g]=y),t[g]=r[g];f=u+a}return!0}},TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return 1>(e*=2)?.5*e*e:-0.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return 1>(e*=2)?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return 1>(e*=2)?.5*e*e*e*e:-0.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return 1>(e*=2)?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:1>(e*=2)?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return 1>(e*=2)?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-(n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/.4)))},Out:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*2*Math.PI/.4)+1)},InOut:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),1>(e*=2)?-0.5*n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/.4):.5*n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*2*Math.PI/.4)+1)}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){return 1>(e*=2)?.5*e*e*(3.5949095*e-2.5949095):.5*((e-=2)*e*(3.5949095*e+2.5949095)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*TWEEN.Easing.Bounce.In(2*e):.5*TWEEN.Easing.Bounce.Out(2*e-1)+.5}}},TWEEN.Interpolation={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),s=TWEEN.Interpolation.Utils.Linear;return 0>t?s(e[0],e[1],r):1<t?s(e[n],e[n-1],n-r):s(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){var n=0,r=e.length-1,i=Math.pow,s=TWEEN.Interpolation.Utils.Bernstein,o;for(o=0;o<=r;o++)n+=i(1-t,r-o)*i(t,o)*e[o]*s(r,o);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),s=TWEEN.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(0>t&&(i=Math.floor(r=n*(1+t))),s(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):0>t?e[0]-(s(e[0],e[0],e[1],e[1],-r)-e[0]):1<t?e[n]-(s(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):s(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=TWEEN.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n=1,r;if(e[t])return e[t];for(r=t;1<r;r--)n*=r;return e[t]=n}}(),CatmullRom:function(e,t,n,r,i){var e=.5*(n-e),r=.5*(r-t),s=i*i;return(2*t-2*n+e+r)*i*s+(-3*t+3*n-2*e-r)*s+e*i+t}}},define("tween",function(){}),define("engine/bullet",["tween"],function(e){return{init:function(e){function t(t){var n=t===!1?1:.06,r;r=(new TWEEN.Tween({warp:e.warp()})).to({warp:n},600).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){e.warp(this.warp)}).start()}e.on("step",function(e){TWEEN.update()}),e.on("arrow:ready",function(){setTimeout(function(){t(!0),setTimeout(function(){t(!1)},3e3)},70)})}}}),define("engine/collisions",[],function(){function e(e,t,n){return e.bodyA.name===t&&e.bodyB.name===n||e.bodyA.name===n&&e.bodyB.name===t}return{init:function(t){t.on("collisions:detected",function(n){if(t.state!=="strike")return;var r;for(var i=0,s=n.collisions.length;i<s;i++)r=n.collisions[i],e(r,"ball","crossbar")===!0?t.emit("ball:crossbar"):e(r,"ball","hand")===!0&&t.emit("ball:hand")})}}}),define("engine/game",["physics","engine/viewport","engine/background","engine/ball","engine/objects","engine/Points","engine/arrow","engine/goalkeeper","engine/bullet","engine/collisions","plugins/audio","c/twist/vm","c/psychic/vm"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function y(e){m.state=e,v.notify(e)}function b(){h.isEnabled()===!0?(g=r.getRandomVector(),o.drawPsychicArrow(m,g)):g=undefined}var p=700,d=800,v,m,g;return{start:function(t,n){m.round=t,m.isAttack=n,n&&c.show(),e.util.ticker.start(),l.play("stadium"),r.toStart(),u.toStart(),y("start"),b(),h.onHired=b},stop:function(t){setTimeout(function(){l.stop(),e.util.ticker.stop()},t)},load:function(){return $.Deferred(function(e){v=e;if(m){v.notify("loaded");return}t.init(p,d).then(function(e){m=e,n.init(e,p,d),r.init(e),u.init(e),i.init(e),o.init(e),a.init(e),f.init(e),e.on("arrow:ready",function(){y("strike"),l.play("strike"),c.hide(),r.strike(o.strikeVector,g),e.isAttack&&(e.ball.state.angular.vel=-1*c.twistvalue()/200),u.jump(o.strikeVector,g||r.getRandomVector(),g)}),e.on("ball:crossbar",function(){y("crossbar"),e.ball.strikeVector=null,l.play("miss")}),e.on("ball:hand",function(){y("hand"),l.play("miss"),e.ball.strikeVector=null,u.catch()}),e.on("goal",function(){y("goal"),e.ball.strikeVector=null,l.play("goal")}),e.on("ball:stop",function(){y("end")}),v.notify("loaded")})})}}}),define("c/game/vm",["ko","text!./view.html","plugins/component","c/scores/vm","c/psychic/vm","c/twist/vm","engine/game","plugins/localization"],function(e,t,n,r,i,s,o,u){$("*").on("selectstart",function(){return!1});var a,f={isVisibleMeta:e.observable(!1),text:e.observable(""),show:function(e,t,n,s){function l(e,t){f.text(e),f.isVisibleMeta(!0),setTimeout(function(){f.isVisibleMeta(!1),t!=undefined&&t()},2e3)}function c(e){switch(e){case"loaded":f.isVisible(!0),o.start(r.getRound(),s===r.getMoveTeamAB());break;case"start":f.isVisible(!0),l(s===r.getMoveTeamAB()?u.turnPlayer():u.turnComputer());break;case"goal":o.stop(1500),l(u.goal(),function(){h(!0)});break;case"end":o.stop(0),l(u.miss(),function(){h(!1)});break;case"crossbar":l(u.crossbar())}}function h(e){if(window.cfg.debug){f.isVisible(!1),r.isVisible(!1),i.isVisible(!1),a.resolve(1,0);return}var t=r.next(e);if(!t){o.start(r.getRound(),s===r.getMoveTeamAB());return}l(t,function(){f.isVisible(!1),i.isVisible(!1),r.isVisible(!1),a.resolve(r.goalsA(),r.goalsB())})}r.show(e,t,s,n),i.show();var f=this;return o.load().progress(c),$.Deferred(function(e){a=e})},test:function(){var e=this;require(["plugins/options","plugins/loader"],function(t,n){n.load(n.resources.ENGINE).then(function(){e.show(t.teams[0],t.teams[1],"A","A").then(function(e,t){alert(e+" : "+t)})})})}};return n.add(f,t,"game")}),define("text!c/result/view.html",[],function(){return'<div class="result" data-bind="visible: isVisible">\r\n    <h1 data-bind="text: title"></h1>\r\n\r\n    <p class="score" data-bind="text: score"></p>\r\n\r\n    <div class="info">\r\n        <!-- ko if: team -->\r\n        <p><team params="name: \'result1\', team: team()"></team></p>\r\n        <!-- /ko -->\r\n\r\n        <p><span data-bind="text: txtPlace"></span> <span>:</span> <span data-bind="text: place"></span></p>\r\n\r\n        <p><span data-bind="text: txtGoals"></span> <span>:</span> <span data-bind="text: goals"></span></p>\r\n    </div>\r\n\r\n    <a data-bind="text: linkGroup, attr: { href: communityHref }" class="push_button red" target="_blank"></a>\r\n    <a href="#" class="push_button blue" data-bind="text: linkInvite, click: invite"></a>\r\n</div>'}),define("c/result/vm",["ko","text!./view.html","plugins/component","c/team/vm","social/social","plugins/localization"],function(e,t,n,r,i,s){var o={place:e.observable(),goals:e.observable(),team:e.observable(null),score:e.observable(),title:s.titleResults,txtPlace:s.txtPlace,txtGoals:s.goals,linkGroup:s.linkGroup,linkInvite:s.linkInvite,communityHref:i.getCommunityHref(),show:function(e,t,n,r){this.score(e),this.place(t),this.team(n),this.goals(r),this.isVisible(!0)},invite:function(){i.invite()},test:function(){var e=this;require(["plugins/loader"],function(e){e.load(e.resources.GAME).then(function(){})}),require(["plugins/options"],function(t){e.show(1e3,2,t.teams[2],12)})}};return n.add(o,t,"result")}),define("lifecycle",["ko","plugins/loader","plugins/options","social/social","c/lang/vm","c/info/vm","c/timer/vm","c/sound/vm","c/top/vm","c/intro/vm","c/instruction/vm","c/choice/vm","c/tournament/vm","c/match/vm","c/load/vm","c/game/vm","c/result/vm"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){e.applyBindings({}),t.load(t.resources.GAME).then(function(){return n.load()}).then(function(){return i.show(),s.init(n.player),o.show(n.player.last),u.show(),a.show(n.player),f.show()}).progress(function(e){if(e==="rules"){s.isVisible(!1),f.isVisible(!1),l.show().then(function(){f.isVisible(!0)});return}if(o.highlight())return;f.isVisible(!1),n.save(),s.isVisible(!1),a.isVisible(!1);var i,u,g,y;c.show().then(function(e){return i=e,n.init(e),h.show(e)}).progress(function(e,s){if(e==="end"){var o=s;n.upgrade();var f=(17-o)*1e3+n.goals*10+n.player.exp*15+n.player.goals;f>n.player.score&&(n.player.score=f),n.save();function l(){a.isVisible(!0),m.show(f,o,n.teams[i],n.goals)}window.cfg.publish?r.wallPost(o).then(l):l();return}p.show(s.pair.teamA,s.pair.teamB).then(function(e){return u=e,$.when.apply($,[t.load(t.resources.ENGINE,function(e){d.onPercentChanged(e)}),d.show("Начать игру")])}).then(function(){return g=u===s.pair.teamA?"A":"B",y=i===s.pair.teamA?"A":"B",v.show(n.teams[s.pair.teamA],n.teams[s.pair.teamB],g,y)}).then(function(e,t){s.goalsA=e,s.goalsB=t,y=="A"&&(n.goals+=e,n.miss+=t),h.matchEnded(s)})})})}),window.cfg={debug:!1,payments:!0,publish:!0,server:"https://penaltydb.herokuapp.com/",language:"ru"},requirejs.config({shim:{fb:{exports:"FB"}},paths:{tween:"lib/tween",text:"lib/text",physics:"//cdn.jsdelivr.net/physicsjs/0.6.0/physicsjs.full.min",howler:"//cdnjs.cloudflare.com/ajax/libs/howler/1.1.17/howler.min",jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min",ko:"//cdnjs.cloudflare.com/ajax/libs/knockout/3.2.0/knockout-min",lodash:"//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min",vk:"//vk.com/js/api/xd_connection",fb:"//connect.facebook.net/en_US/all",c:"components/"}}),require(["ko","jquery","text","social/social","social/vk","server/server","server/heroku"],function(e,t,n,r,i,s,o){t.when.apply(t,[r.init(i),s.init(o)]).then(function(){t("*").on("selectstart",function(){return!1});var n=window.location.search,r=n.length>0?n.substring(1):null;window.cfg.debug===!0&&r?require(["c/"+r+"/vm"],function(t){window.stopSpinner(),e.applyBindings({}),t.test()}):require(["lifecycle"])})}),define("main",function(){}),define("text!components/choice/view.html",[],function(){return'<div class="choice" data-bind="visible: isVisible">\r\n    <h1 data-bind="text: title"></h1>\r\n    <!-- ko if: items -->\r\n    <ul id="pairs8" data-bind="foreach: items">\r\n        <li data-bind="click: function() { $parent.ok($index()); }">\r\n            <team params="name: \'choice\' + $index(), team: $data"></team>\r\n        </li>\r\n    </ul>\r\n    <!-- /ko -->\r\n</div>'}),define("components/choice/vm",["ko","text!./view.html","plugins/component","c/team/vm","plugins/localization","model/teams"],function(e,t,n,r,i,s){var o,u={isVisible:e.observable(!1),items:e.observableArray(s),title:i.choiceTitle,show:function(){return this.isVisible(!0),$.Deferred(function(e){o=e})},ok:function(e){this.isVisible(!1),o.resolve(e)},test:function(){require(["plugins/loader"],function(e){e.load(e.resources.GAME).then(function(){})}),this.show().then(function(e){alert("Selected team is "+e)})}};return n.add(u,t,"choice")}),define("text!components/game/view.html",[],function(){return'<div class="game" data-bind="visible: isVisible">\r\n\r\n    <scores></scores>\r\n\r\n    <div class="meta" data-bind="visible: isVisibleMeta">\r\n        <h1 data-bind="text: text"></h1>\r\n    </div>\r\n\r\n    <twist></twist>\r\n    <psychic></psychic>\r\n\r\n    <canvas id="viewport"></canvas>\r\n</div>\r\n'}),define("components/game/vm",["ko","text!./view.html","plugins/component","c/scores/vm","c/psychic/vm","c/twist/vm","engine/game","plugins/localization"],function(e,t,n,r,i,s,o,u){$("*").on("selectstart",function(){return!1});var a,f={isVisibleMeta:e.observable(!1),text:e.observable(""),show:function(e,t,n,s){function l(e,t){f.text(e),f.isVisibleMeta(!0),setTimeout(function(){f.isVisibleMeta(!1),t!=undefined&&t()},2e3)}function c(e){switch(e){case"loaded":f.isVisible(!0),o.start(r.getRound(),s===r.getMoveTeamAB());break;case"start":f.isVisible(!0),l(s===r.getMoveTeamAB()?u.turnPlayer():u.turnComputer());break;case"goal":o.stop(1500),l(u.goal(),function(){h(!0)});break;case"end":o.stop(0),l(u.miss(),function(){h(!1)});break;case"crossbar":l(u.crossbar())}}function h(e){if(window.cfg.debug){f.isVisible(!1),r.isVisible(!1),i.isVisible(!1),a.resolve(1,0);return}var t=r.next(e);if(!t){o.start(r.getRound(),s===r.getMoveTeamAB());return}l(t,function(){f.isVisible(!1),i.isVisible(!1),r.isVisible(!1),a.resolve(r.goalsA(),r.goalsB())})}r.show(e,t,s,n),i.show();var f=this;return o.load().progress(c),$.Deferred(function(e){a=e})},test:function(){var e=this;require(["plugins/options","plugins/loader"],function(t,n){n.load(n.resources.ENGINE).then(function(){e.show(t.teams[0],t.teams[1],"A","A").then(function(e,t){alert(e+" : "+t)})})})}};return n.add(f,t,"game")}),define("text!components/info/view.html",[],function(){return'<div class="info" data-bind="visible: isVisible">\r\n    <div class="back"></div>\r\n    <div>\r\n        <!-- ko if: user -->\r\n        <img alt="" src="" data-bind="attr: { src: user().img }">\r\n        <p class="name" data-bind="text: user().name"></p>\r\n        <p><span data-bind="text: scores"></span> : <span data-bind="text: user().score"></span></p>\r\n        <p><span data-bind="text: goals"></span> : <span data-bind="text: user().goals"></span></p>\r\n        <p><span data-bind="text: exp"></span> : <span data-bind="text: user().exp"></span></p>\r\n        <!-- /ko -->\r\n    </div>\r\n</div>'}),define("components/info/vm",["ko","text!./view.html","plugins/component","plugins/localization"],function(e,t,n,r){var i={user:e.observable(null),scores:r.scores,goals:r.goals,exp:r.exp,show:function(e){if(e.id==0)return;this.user(e),this.isVisible(!0)},hide:function(){this.user(this.defaultUser)},init:function(e){this.defaultUser=e,this.hide()},test:function(){var e=this;require(["controllers/users"],function(t){t.getMe().then(function(t){e.show(t)})})}};return n.add(i,t,"info")}),define("text!components/instruction/view.html",[],function(){return'<div class="instruction" data-bind="visible: isVisible">\r\n    <h1 data-bind="text: title">Инструкция</h1>\r\n    <p data-bind="text: rules1">1. Для удара по мячу необходимо зажать левую кнопку мыши на мяче и потянуть в направлении удара, а затем отпустить.</p>\r\n    <p data-bind="text: rules2">2. Для выбора направления прыжка вратаря необходимо зажать левую кнопку мыши на голове вратаря и потянуть в направлении прыжка, а затем отпустить.</p>\r\n    <img alt="" src=""/>\r\n\r\n    <br/>\r\n    <br/>\r\n    <a id="rulelink" target="_blank" data-bind="text: rulePenalty" href="//ru.wikipedia.org/wiki/%D0%9F%D0%BE%D1%81%D0%BB%D0%B5%D0%BC%D0%B0%D1%82%D1%87%D0%B5%D0%B2%D1%8B%D0%B5_%D0%BF%D0%B5%D0%BD%D0%B0%D0%BB%D1%8C%D1%82%D0%B8"></a>\r\n    <br/>\r\n    <br/>\r\n\r\n    <a href="#" class="button" data-bind="click: back">\r\n        <span data-bind="text: prev"></span>\r\n    </a>\r\n</div>'}),define("components/instruction/vm",["ko","text!./view.html","plugins/component","plugins/localization"],function(e,t,n,r){var i,s={title:r.instructionTitle,rules1:r.rules1,rules2:r.rules2,rulePenalty:r.rulePenalty,prev:r.prev,show:function(){return this.isVisible(!0),$.Deferred(function(e){i=e})},back:function(){var e=this;setTimeout(function(){e.isVisible(!1),i.resolve()},300)},test:function(){require(["plugins/loader"],function(e){e.load(e.resources.GAME).then(function(){})}),this.show().then(function(){console.log("back")})}};return n.add(s,t,"instruction")}),define("text!components/intro/view.html",[],function(){return'<div class="intro" data-bind="visible: isVisible">\r\n    <h1 data-bind="text: header1"></h1>\r\n    <h2 data-bind="text: header2"></h2>\r\n\r\n    <p data-bind="text: desc"></p>\r\n\r\n    <a href="#" class="button" data-bind="click: start">\r\n        <span data-bind="text: btnStart"></span>\r\n    </a>\r\n\r\n    <br/>\r\n\r\n    <a href="#" class="button" data-bind="click: rules">\r\n        <span data-bind="text: btnInstruction"></span>\r\n    </a>\r\n</div>'}),define("components/intro/vm",["ko","text!./view.html","plugins/component","plugins/localization"],function(e,t,n,r){var i,s={header1:r.header1,header2:r.header2,desc:r.introDesc,btnStart:r.btnStart,btnInstruction:r.btnInstruction,show:function(){return this.isVisible(!0),$.Deferred(function(e){i=e})},start:function(){var e=this;setTimeout(function(){i.notify("start")},300)},rules:function(){var e=this;setTimeout(function(){i.notify("rules")},300)},test:function(){require(["plugins/loader"],function(e){e.load(e.resources.GAME).then(function(){})}),this.show().progress(function(e){alert(e)})}};return n.add(s,t,"intro")}),define("text!components/lang/view.html",[],function(){return'<div class="lang" data-bind="visible: isVisible">\r\n    <div class="container">\r\n        <div class="switch">\r\n            <input type="radio" class="switch-input" name="lang" value="en" id="en" data-bind="attr: { checked: lang() == \'en\' }">\r\n            <label for="en" class="switch-label" data-bind="event: { mouseup: en }">EN</label>\r\n            <input type="radio" class="switch-input" name="lang" value="ru" id="ru" data-bind="attr: { checked: lang() == \'ru\' }">\r\n            <label for="ru" class="switch-label ru" data-bind="event: { mouseup: ru }">RU</label>\r\n            <span class="switch-selection"></span>\r\n        </div>\r\n    </div>\r\n</div>'}),define("components/lang/vm",["ko","text!./view.html","plugins/component","plugins/localization"],function(e,t,n,r){var i={lang:e.observable(window.cfg.language),show:function(){this.isVisible(!0)},en:function(){this.lang("en"),r.setLanguage("en")},ru:function(){this.lang("ru"),r.setLanguage("ru")},test:function(){this.show()}};return n.add(i,t,"lang")}),define("text!components/load/view.html",[],function(){return'<div class="load" data-bind="visible: isVisible">\r\n    <div class="loading">\r\n    <progress max="100" data-bind="attr: { value: percent }" class="css3">\r\n    </progress>\r\n    <a href="#" class="button" data-bind="click: start, visible: isLoaded">\r\n        <span data-bind="text: buttonName"></span>\r\n    </a>\r\n    </div>\r\n</div>'}),define("components/load/vm",["ko","text!./view.html","plugins/component","jquery","plugins/localization"],function(e,t,n,r,i){var s,o={isLoaded:e.observable(!1),percent:e.observable(0),buttonName:i.btnStart,show:function(){this.percent(0),this.isVisible(!0),this.isLoaded(!1);var e=this;return r.Deferred(function(e){s=e})},onPercentChanged:function(e){this.percent(e),e===100&&this.isLoaded(!0)},start:function(){this.isVisible(!1),s.resolve()},test:function(){function n(){t.onPercentChanged(e),e<100&&window.setTimeout(n,10),e++}this.show().then(function(){console.log("Finish")});var e=0,t=this;n()}};return n.add(o,t,"load")}),define("text!components/match/view.html",[],function(){return'<div class="match" data-bind="visible: isVisible">\r\n\r\n    <br/>\r\n    <br/>\r\n    <br/>\r\n\r\n    <div class="teams">\r\n        <!-- ko if: teamA() >= 0 -->\r\n        <team params="name: \'match1\', team: teams[teamA()]"></team>\r\n        <!-- /ko -->\r\n        <p>VS</p>\r\n        <!-- ko if: teamB() >= 0 -->\r\n        <team params="name: \'match2\', team: teams[teamB()]"></team>\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n    <h2 data-bind="text: firstTurn">Право первого удара: </h2>\r\n    <a href="#" class="push_button blue small" data-bind="text: drawLot, visible: isBallotVisible, click: ballot"></a>\r\n    <!-- ko if: firstTeam() >= 0 -->\r\n    <team params="name: \'match3\', team: teams[firstTeam()]"></team>\r\n    <!-- /ko -->\r\n\r\n    <br/>\r\n    <br/>\r\n    <br/>\r\n\r\n    <a href="#" class="button" data-bind="visible: isBeginVisible, click: beginGame">\r\n        <span data-bind="text: btnStart"></span>\r\n    </a>\r\n\r\n</div>'}),define("components/match/vm",["ko","text!./view.html","plugins/component","c/team/vm","plugins/localization","model/teams"],function(e,t,n,r,i,s){function o(e,t){return Math.random()*(t-e)+e|0}var u,a={isBallotVisible:e.observable(!0),isBeginVisible:e.observable(!1),teamA:e.observable(-1),teamB:e.observable(-1),firstTeam:e.observable(-1),teams:s,firstTurn:i.firstTurn,drawLot:i.drawLot,btnStart:i.btnStart,show:function(e,t){return this.isBallotVisible(!0),this.isBeginVisible(!1),this.firstTeam(-1),this.teamA(-1),this.teamB(-1),this.teamA(e),this.teamB(t),this.isVisible(!0),$.Deferred(function(e){u=e})},beginGame:function(){this.isVisible(!1),u.resolve(this.firstTeam())},ballot:function(){this.isBeginVisible(!0),this.isBallotVisible(!1),this.firstTeam(o(0,2)===0?this.teamA():this.teamB())},test:function(){var e=this;require(["plugins/loader"],function(e){e.load(e.resources.GAME).then(function(){})}),e.show(1,2).then(function(e){alert("First turn team is "+e)})}};return n.add(a,t,"match")}),define("text!components/member/view.html",[],function(){return'<li class="member" data-bind="visible: isVisible, click: click, event: { mouseover: function() { hover($data); }, mouseout: out }">\r\n    <!-- ko if: user -->\r\n    <img class="ava" src="" data-bind="attr: { src: user().img, title: user().name }" />\r\n    <img alt="star" src="components/member/star.png" class="star" data-bind="visible: user().place < 3" style="right: 0"/>\r\n    <img alt="star" src="components/member/star.png" class="star" data-bind="visible: user().place < 2" style="right: 16px"/>\r\n    <img alt="star" src="components/member/star.png" class="star" data-bind="visible: user().place < 1" style="right: 32px"/>\r\n    <!-- /ko -->\r\n</li>'}),define("components/member/vm",["ko","text!./view.html","plugins/component","c/info/vm","social/social"],function(e,t,n,r,i){function s(){this.user=e.observable(),this.show=function(e){this.set(e),this.isVisible(!0)},this.set=function(e){e&&e.user&&this.user(e.user)},this.click=function(){if(this.user().id==0){i.invite();return}var e=i.getUserUrl(this.user().id),t=window.open(e,"_blank");t.focus()},this.test=function(){var e=this;require(["controllers/users"],function(t){t.getMe().then(function(t){e.show({user:t})})})},this.hover=function(e){r.show(e.user())},this.out=function(){r.hide()}}return n.add(s,t,"member")}),define("text!components/psychic/view.html",[],function(){return'<div class="psychic" data-bind="visible: isVisible() && isPaymentEnabled">\r\n\r\n    <img alt="" src="components/psychic/psychic.png" data-bind="click: buy, event: { mouseover: hover, mouseout: out }, css: { enabled: isEnabled }" />\r\n    <div class="text" data-bind="text: text, visible: textVisible() && !isEnabled()"></div>\r\n    <div class="text bought" data-bind="text: textEnabled, visible: textVisible() && isEnabled()"></div>\r\n\r\n</div>\r\n'}),define("components/psychic/vm",["ko","text!./view.html","plugins/component","plugins/localization","social/social"],function(e,t,n,r,i){var s={isPaymentEnabled:window.cfg.payments,textVisible:e.observable(!1),text:r.psychicText,isEnabled:e.observable(!1),textEnabled:r.psychicTextEnabled,show:function(){this.isVisible(!0),this.isEnabled(!1)},buy:function(){if(this.isEnabled()===!0)return;var e=this;i.showOrderBox().then(function(){e.isEnabled(!0),e.onHired&&e.onHired()})},onHired:null,hover:function(){this.textVisible(!0)},out:function(){this.textVisible(!1)},test:function(){this.show()}};return n.add(s,t,"psychic")}),define("text!components/result/view.html",[],function(){return'<div class="result" data-bind="visible: isVisible">\r\n    <h1 data-bind="text: title"></h1>\r\n\r\n    <p class="score" data-bind="text: score"></p>\r\n\r\n    <div class="info">\r\n        <!-- ko if: team -->\r\n        <p><team params="name: \'result1\', team: team()"></team></p>\r\n        <!-- /ko -->\r\n\r\n        <p><span data-bind="text: txtPlace"></span> <span>:</span> <span data-bind="text: place"></span></p>\r\n\r\n        <p><span data-bind="text: txtGoals"></span> <span>:</span> <span data-bind="text: goals"></span></p>\r\n    </div>\r\n\r\n    <a data-bind="text: linkGroup, attr: { href: communityHref }" class="push_button red" target="_blank"></a>\r\n    <a href="#" class="push_button blue" data-bind="text: linkInvite, click: invite"></a>\r\n</div>'}),define("components/result/vm",["ko","text!./view.html","plugins/component","c/team/vm","social/social","plugins/localization"],function(e,t,n,r,i,s){var o={place:e.observable(),goals:e.observable(),team:e.observable(null),score:e.observable(),title:s.titleResults,txtPlace:s.txtPlace,txtGoals:s.goals,linkGroup:s.linkGroup,linkInvite:s.linkInvite,communityHref:i.getCommunityHref(),show:function(e,t,n,r){this.score(e),this.place(t),this.team(n),this.goals(r),this.isVisible(!0)},invite:function(){i.invite()},test:function(){var e=this;require(["plugins/loader"],function(e){e.load(e.resources.GAME).then(function(){})}),require(["plugins/options"],function(t){e.show(1e3,2,t.teams[2],12)})}};return n.add(o,t,"result")}),define("text!components/scores/view.html",[],function(){return'<div class="scores" data-bind="visible: isVisible">\r\n\r\n    <!-- ko if: teamA() && teamB() -->\r\n    <div class="score">\r\n        <team params="name: \'scores1\', team: teamA(), position: \'right\'"></team>\r\n        <span class="value" data-bind="text: \'\' + goalsA() + \':\' + goalsB()"></span>\r\n        <team params="name: \'scores2\', team: teamB(), position: \'left\'"></team>\r\n    </div>\r\n    <div class="stats">\r\n        <div class="round">\r\n            <div data-bind="css: teamA().className"></div>\r\n            <div data-bind="css: teamB().className"></div>\r\n        </div>\r\n        <!-- ko foreach: rounds -->\r\n        <div class="round">\r\n            <div data-bind="css: A"></div>\r\n            <div data-bind="css: B"></div>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n</div>\r\n'}),define("components/scores/vm",["ko","text!./view.html","plugins/component","c/team/vm","plugins/localization"],function(e,t,n,r,i){function f(e,t){return Math.random()*(t-e)+e|0}var s,o,u,a,l={teamA:e.observable(null),teamB:e.observable(null),goalsA:e.observable(0),goalsB:e.observable(0),rounds:e.observableArray([]),getRound:function(){return this.rounds.length},getMoveTeamAB:function(){return o},newRound:function(){a={A:e.observable("none"),B:e.observable("none")},this.rounds.push(a)},show:function(e,t,n,r){u=n,o=r,s=1,this.rounds([]),this.teamA(null),this.teamB(null),this.goalsA(0),this.goalsB(0),this.teamA(e),this.teamB(t),this.newRound(),a[o]("move"),this.isVisible(!0)},next:function(e){a[o](e?"goal":"miss"),s%2===0&&this.newRound(),e&&(o==="A"?this.goalsA(this.goalsA()+1):this.goalsB(this.goalsB()+1));if(s>=10&&s%2===0&&Math.abs(this.goalsA()-this.goalsB())>0){var t=u=="A"?this.goalsA()>this.goalsB()?i.txtWin():i.txtDefeat():this.goalsA()>this.goalsB()?i.txtDefeat():i.txtWin();return t}return s++,o=o==="A"?"B":"A",a[o]("move"),null},test:function(){var e=this;require(["plugins/options"],function(t){e.show(t.teams[2],t.teams[3],"A","A"),$(".score").css("background-color","grey");var n=setInterval(function(){var t=e.next(f(0,2)===1);t&&(clearInterval(n),alert("result"))},1e3)})}};return n.add(l,t,"scores")}),define("text!components/sound/view.html",[],function(){return'<div class="sound" data-bind="visible: isVisible, click: press" title="Звук">\r\n    <img class="on" src="components/sound/mute.png" alt="" data-bind="visible: isMuted" />\r\n    <img class="off" src="components/sound/unmute.png" alt="" data-bind="visible: isMuted() === false" />\r\n</div>'}),define("components/sound/vm",["ko","text!./view.html","plugins/component","plugins/audio"],function(e,t,n,r){var i={isMuted:e.observable(!1),show:function(){this.isVisible(!0)},unmute:function(){r.unmute(),this.isMuted(!1)},mute:function(){r.mute(),this.isMuted(!0)},press:function(){r.isMuted()?this.unmute():this.mute()},test:function(){var e=this;require(["plugins/loader"],function(t){t.load(t.resources.ENGINE).then(function(){e.show(),r.play("stadium")})})}};return n.add(i,t,"sound")}),define("text!components/team/view.html",[],function(){return'<div class="team" data-bind="visible: isVisible">\r\n    <!-- ko if: team -->\r\n\r\n    <!-- ko if: position() == \'left\' -->\r\n    <div data-bind="css: team().className"></div>\r\n    <span data-bind="text: team().name, css: { \'playerTeam\': team().isPlayer }"></span>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: position() == \'right\' -->\r\n    <span data-bind="text: team().name, css: { \'playerTeam\': team().isPlayer }"></span>\r\n    <div data-bind="css: team().className"></div>\r\n    <!-- /ko -->\r\n\r\n    <!-- /ko -->\r\n</div>'}),define("components/team/vm",["ko","text!./view.html","plugins/component"],function(e,t,n){function r(){this.team=e.observable(),this.position=e.observable("left"),this.show=function(e){this.set(e),this.isVisible(!0)},this.set=function(e){e&&e.team&&this.team(typeof e.team=="function"?e.team():e.team),this.position(e&&e.position?e.position:"left")},this.test=function(){var e=this;require(["model/teams"],function(t){e.show({team:t[0]})})}}return n.add(r,t,"team")}),define("text!components/timer/view.html",[],function(){return'<div class="timer" data-bind="visible: isVisible, click: click">\r\n    <p class="desc" data-bind="text: txtTimer"></p>\r\n    <p class="time" data-bind="text: value"></p>\r\n    <div class="popup" data-bind="visible: isPaymentEnabled, text: txtTimerVote">\r\n    </div>\r\n</div>'}),define("components/timer/vm",["ko","text!./view.html","plugins/component","jquery","plugins/localization","social/social"],function(e,t,n,r,i,s){var o,u,a=!1,f={isPaymentEnabled:window.cfg.payments,value:e.observable(""),txtTimer:i.txtTimer,txtTimerVote:i.txtTimerVote,setValue:function(){var e=Math.floor(u/60),t=Math.floor(u%60);t<10&&(t="0"+t),this.value(e+":"+t)},test:function(){this.show(Date.now())},click:function(){var e=this;if(!this.isPaymentEnabled)return;s.showOrderBox().then(function(){e.isVisible(!1),a=!0})},show:function(e){a=!1;if(o)return;var t=(Date.now()-e)/1e3,n=t/60;if(n>=10)return;var r=6e5-(Date.now()-e);u=Math.floor(r/1e3),this.setValue();var i=this;o=setInterval(function(){u--,i.setValue(),u===0&&(i.isVisible(!1),clearInterval(o))},1e3),this.isVisible(!0)},highlight:function(){return a?!1:u?(r(".timer").animate({opacity:1},200).animate({color:"red"},100).animate({opacity:.3},500),!0):!1}};return n.add(f,t,"timer")}),define("text!components/top/view.html",[],function(){return'<div class="top" data-bind="visible: isVisible()">\r\n    <ul data-bind="foreach: visibleUsers">\r\n        <member params="name: \'top\' + $index(), user: $data"></member>\r\n    </ul>\r\n    <div class="container">\r\n        <div class="switch">\r\n            <input type="radio" class="switch-input" name="top" value="friends" id="friends" checked >\r\n            <label for="friends" class="switch-label" data-bind="text: linkTopFriends, event: { mouseup: toFriendsTop }"></label>\r\n            <input type="radio" class="switch-input" name="top" value="top" id="top" >\r\n            <label for="top" class="switch-label modetop" data-bind="text: linkTopAll, event: { mouseup: toAllTop }"></label>\r\n            <span class="switch-selection"></span>\r\n        </div>\r\n    </div>\r\n</div>'}),define("components/top/vm",["ko","text!./view.html","plugins/component","c/member/vm","controllers/users","plugins/localization"],function(e,t,n,r,i,s){function u(e,t){return t.score-e.score}var o=9,a,f={isVisible:e.observable(!1),myself:null,users:e.observableArray(),visibleUsers:e.observableArray(),page:e.observable(0),linkTopFriends:s.linkTopFriends,linkTopAll:s.linkTopAll,show:function(e){this.myself=e,this.toFriendsTop(),this.isVisible(!0)},setVisibleUsers:function(e){a==="friends"&&(e=[this.myself].concat(e)),e.sort(u),e.forEach(function(e,t){e.place=a==="top"?t:undefined}),this.users(e);var t=[];for(var n=this.page()*o,r=0;n<this.users().length&&r<o;n++,r++)t.push(this.users()[n]);for(;n<o;n++)t.push(i.newPlayer());this.visibleUsers(t)},toAllTop:function(){a="top",this.getUsers(i.getTopUsers)},toFriendsTop:function(){a="friends",this.getUsers(i.getFriendsUsers)},getUsers:function(e){var t=this;e().then(function(e){t.setVisibleUsers(e)})},test:function(){var e=this;require(["plugins/loader"],function(e){e.load(e.resources.GAME).then(function(){})}),i.getMe().then(function(t){e.show(t)})}};return n.add(f,t,"top")}),define("text!components/tournament/view.html",[],function(){return'<div class="tournament" data-bind="visible: isVisible">\r\n    <div id="tournament-table">\r\n        <img alt="" src="components/tournament/table.png"/>\r\n    </div>\r\n    <!-- ko if: rounds()[0] -->\r\n    <team id="t00" class="t t0" params="name: \'tournament\' + 0, team: teams[rounds()[0][0].teamA]"></team>\r\n    <team id="t01" class="t t0" params="name: \'tournament\' + 1, team: teams[rounds()[0][0].teamB]"></team>\r\n    <team id="t02" class="t t0" params="name: \'tournament\' + 2, team: teams[rounds()[0][1].teamA]"></team>\r\n    <team id="t03" class="t t0" params="name: \'tournament\' + 3, team: teams[rounds()[0][1].teamB]"></team>\r\n    <team id="t04" class="t t0" params="name: \'tournament\' + 4, team: teams[rounds()[0][2].teamA]"></team>\r\n    <team id="t05" class="t t0" params="name: \'tournament\' + 5, team: teams[rounds()[0][2].teamB]"></team>\r\n    <team id="t06" class="t t0" params="name: \'tournament\' + 6, team: teams[rounds()[0][3].teamA]"></team>\r\n    <team id="t07" class="t t0" params="name: \'tournament\' + 7, team: teams[rounds()[0][3].teamB]"></team>\r\n    <team id="t08" class="t t0" params="name: \'tournament\' + 8, team: teams[rounds()[0][4].teamA]"></team>\r\n    <team id="t09" class="t t0" params="name: \'tournament\' + 9, team: teams[rounds()[0][4].teamB]"></team>\r\n    <team id="t010" class="t t0" params="name: \'tournament\' + 10, team: teams[rounds()[0][5].teamA]"></team>\r\n    <team id="t011" class="t t0" params="name: \'tournament\' + 11, team: teams[rounds()[0][5].teamB]"></team>\r\n    <team id="t012" class="t t0" params="name: \'tournament\' + 12, team: teams[rounds()[0][6].teamA]"></team>\r\n    <team id="t013" class="t t0" params="name: \'tournament\' + 13, team: teams[rounds()[0][6].teamB]"></team>\r\n    <team id="t014" class="t t0" params="name: \'tournament\' + 14, team: teams[rounds()[0][7].teamA]"></team>\r\n    <team id="t015" class="t t0" params="name: \'tournament\' + 15, team: teams[rounds()[0][7].teamB]"></team>\r\n    <p id="t0score0" class="s t0score" data-bind="text: rounds()[0][0].score"></p>\r\n    <p id="t0score1" class="s t0score" data-bind="text: rounds()[0][1].score"></p>\r\n    <p id="t0score2" class="s t0score" data-bind="text: rounds()[0][2].score"></p>\r\n    <p id="t0score3" class="s t0score" data-bind="text: rounds()[0][3].score"></p>\r\n    <p id="t0score4" class="s t0score" data-bind="text: rounds()[0][4].score"></p>\r\n    <p id="t0score5" class="s t0score" data-bind="text: rounds()[0][5].score"></p>\r\n    <p id="t0score6" class="s t0score" data-bind="text: rounds()[0][6].score"></p>\r\n    <p id="t0score7" class="s t0score" data-bind="text: rounds()[0][7].score"></p>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: rounds()[1] -->\r\n    <team id="t10" class="t t1" params="name: \'tournament\' + 16, team: teams[rounds()[1][0].teamA]"></team>\r\n    <team id="t11" class="t t1" params="name: \'tournament\' + 17, team: teams[rounds()[1][0].teamB]"></team>\r\n    <team id="t12" class="t t1" params="name: \'tournament\' + 18, team: teams[rounds()[1][1].teamA]"></team>\r\n    <team id="t13" class="t t1" params="name: \'tournament\' + 19, team: teams[rounds()[1][1].teamB]"></team>\r\n    <team id="t14" class="t t1" params="name: \'tournament\' + 20, team: teams[rounds()[1][2].teamA]"></team>\r\n    <team id="t15" class="t t1" params="name: \'tournament\' + 21, team: teams[rounds()[1][2].teamB]"></team>\r\n    <team id="t16" class="t t1" params="name: \'tournament\' + 22, team: teams[rounds()[1][3].teamA]"></team>\r\n    <team id="t17" class="t t1" params="name: \'tournament\' + 23, team: teams[rounds()[1][3].teamB]"></team>\r\n    <p id="t1score0" class="s t1score" data-bind="text: rounds()[1][0].score"></p>\r\n    <p id="t1score1" class="s t1score" data-bind="text: rounds()[1][1].score"></p>\r\n    <p id="t1score2" class="s t1score" data-bind="text: rounds()[1][2].score"></p>\r\n    <p id="t1score3" class="s t1score" data-bind="text: rounds()[1][3].score"></p>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: rounds()[2] -->\r\n    <team id="t20" class="t t2" params="name: \'tournament\' + 24, team: teams[rounds()[2][0].teamA]"></team>\r\n    <team id="t21" class="t t2" params="name: \'tournament\' + 25, team: teams[rounds()[2][0].teamB]"></team>\r\n    <team id="t22" class="t t2" params="name: \'tournament\' + 26, team: teams[rounds()[2][1].teamA]"></team>\r\n    <team id="t23" class="t t2" params="name: \'tournament\' + 27, team: teams[rounds()[2][1].teamB]"></team>\r\n    <p id="t2score0" class="s t2score" data-bind="text: rounds()[2][0].score"></p>\r\n    <p id="t2score1" class="s t2score" data-bind="text: rounds()[2][1].score"></p>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: rounds()[3] -->\r\n    <team id="t30" class="t t3" params="name: \'tournament\' + 28, team: teams[rounds()[3][0].teamA]"></team>\r\n    <team id="t31" class="t t3" params="name: \'tournament\' + 29, team: teams[rounds()[3][0].teamB]"></team>\r\n    <p id="t3score0" class="s t3score" data-bind="text: rounds()[3][0].score"></p>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: champion() >= 0 -->\r\n    <team id="champion" class="t" params="name: \'tournament\' + 30, team: teams[champion()]"></team>\r\n    <!-- /ko -->\r\n\r\n    <div id="go-round">\r\n        <a href="#" class="push_button blue small" data-bind="text: txtGoRound, visible: isGoRoundButtonVisible, click: goRound"></a>\r\n    </div>\r\n\r\n</div>'}),define("components/tournament/vm",["ko","text!./view.html","plugins/component","c/team/vm","plugins/localization","model/teams"],function(e,t,n,r,i,s){function u(e,t){return Math.random()*(t-e)+e|0}function a(){var t=[],n=[],r,i,o,a,f,l;for(l=0;l<s.length;l++)n.push(l);while(n.length>0)r=u(0,n.length),o=n[r],n.splice(r,1),i=u(0,n.length),a=n[i],n.splice(i,1),f={teamA:o,teamB:a,score:e.observable("-:-")},t.push(f);return t}function f(e){var t=0;for(var n=0;n<5;n++)u(0,10+e)>4&&t++;return t}function l(e,t,n){e.score(""+t+":"+n),e.winner=t>n?e.teamA:e.teamB}var o,c,h,p={isGoRoundButtonVisible:e.observable(!1),rounds:e.observableArray(),teams:s,champion:e.observable(-1),txtGoRound:i.txtGoRound,show:function(e){return c=0,h=e,this.isVisible(!0),this.isGoRoundButtonVisible(!0),this.rounds.push(a()),$.Deferred(function(e){o=e})},goRound:function(){var e=this;this.isGoRoundButtonVisible(!1);var t=this.rounds()[c],n={round:c};for(var r=0;r<t.length;r++){var i=t[r];if(h===i.teamA||h===i.teamB)n.pair=i,this.isVisible(!1),o.notify("match",n);else{var u=s[i.teamA],a=s[i.teamB],p=f(u.power-a.power),d=f(a.power-u.power);p===d&&(u.power-a.power>0?p++:d++),l(i,p,d)}}},matchEnded:function(e){this.isVisible(!0),l(e.pair,e.goalsA,e.goalsB),this.setNewTeamPairs();if(e.pair.winner!==h){var t;switch(c){case 0:t=16;break;case 1:t=8;break;case 2:t=4;break;case 3:t=2}this.isVisible(!1),o.notify("end",t)}},setNewTeamPairs:function(){var t=[],n=this.rounds()[c];if(c===3){var r=n[0].winner;r===h&&(this.isVisible(!1),o.notify("end",1)),this.champion(r);return}for(var i=0;i<n.length;i+=2){var s={teamA:n[i].winner,teamB:n[i+1].winner,score:e.observable("-:-")};t.push(s)}this.rounds.push(t),this.isGoRoundButtonVisible(!0),c++},test:function(){var e=this;require(["plugins/loader"],function(e){e.load(e.resources.GAME).then(function(){})}),require(["plugins/options"],function(t){t.init(5),e.show(5).progress(function(t,n){console.log(t+": "+JSON.stringify(n)),t==="match"?(n.goals1=5,n.goals2=2,e.isVisible(!0),setTimeout(function(){e.matchEnded(n)})):t==="end"&&alert("Your place is "+n)})})}};return n.add(p,t,"tournament")}),define("text!components/twist/view.html",[],function(){return'<div class="twist" data-bind="visible: isVisible">\r\n\r\n    <h4 data-bind="text: txtTwistBall"></h4>\r\n    <img alt="" src="components/twist/brazuca.png" />\r\n    <input class="twistvalue" type="range" min="-10" max="10" value="0" data-bind="value: twistvalue">\r\n\r\n</div>\r\n'}),define("components/twist/vm",["ko","text!./view.html","plugins/component","plugins/localization"],function(e,t,n,r){var i={twistvalue:e.observable(0),txtTwistBall:r.txtTwistBall,show:function(){this.isVisible(!0)},hide:function(){this.isVisible(!1)},test:function(){this.show()}};return n.add(i,t,"twist")});