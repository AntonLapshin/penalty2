define(["jquery","physics"],function(e,t){function n(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{left:t,top:n}}function r(e){var t=n(e.target),r=e.changedTouches&&e.changedTouches[0]||e,i=r.pageX-t.left,s=r.pageY-t.top;return{x:i,y:s}}return{init:function(e,n,i,s,o){function f(e){var n=e.x,r=e.y,i=0,s=0;return n<a.minX?i=a.minX:n>a.maxX?i=a.maxX:i=n,r<a.minY?s=a.minY:r>a.maxY?s=a.maxY:s=r,t.vector(i,s)}this.width=n,this.height=i,this.minX=n/2,this.minY=i/2,this.maxX=s-n,this.maxY=o-i,this.middle={x:n/2,y:i/2};var u=e.getTopLayer(),a=this;e.on("step",function(){a.mode==="follow"?e.getOffset().clone(a.middle).vsub(f(a.followObject.state.pos)):a.mode==="point"&&e.getOffset().clone(a.middle).vsub(f(a.targetPoint))});var l=!1,c=null,h=function(n){var i=e.getPosAbs(new t.vector(r(n))),s=e.findOne({$at:i});s||(l=!0,c=i,a.mode="grab")},p=function(n){if(l){var i=e.getPosAbs(new t.vector(r(n))),s=i.clone().vsub(c),o=e.getOffset(),u=new t.vector(Math.abs(o.x)+a.minX,Math.abs(o.y)+a.minY),h=u.vsub(s);e.getOffset().clone(a.middle).vsub(f(h))}},d=function(e){l=!1,c=null};u.el.addEventListener("mousedown",h),u.el.addEventListener("touchstart",h),u.el.addEventListener("mousemove",p),u.el.addEventListener("touchmove",p),u.el.addEventListener("mouseup",d),u.el.addEventListener("touchend",d)},followObject:null,targetPoint:null,mode:null,follow:function(e){this.targetPoint=null,this.followObject=e,this.mode="follow"},toPoint:function(e){this.followObject=null,this.targetPoint=new t.vector(e),this.mode="point"}}});